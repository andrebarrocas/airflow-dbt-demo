[0m12:10:46.991440 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9db3abb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9b3de760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9b3de820>]}


============================== 12:10:46.995680 | 54e91933-1027-4b0a-adbf-554b5ddf7ba5 ==============================
[0m12:10:46.995680 [info ] [MainThread]: Running with dbt=1.7.3
[0m12:10:46.996173 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '.', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir .', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:10:47.178490 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '54e91933-1027-4b0a-adbf-554b5ddf7ba5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e05ef70>]}
[0m12:10:47.237430 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '54e91933-1027-4b0a-adbf-554b5ddf7ba5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9b4f0460>]}
[0m12:10:47.238208 [info ] [MainThread]: Registered adapter: postgres=1.7.3
[0m12:10:47.243627 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m12:10:47.244421 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m12:10:47.244779 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '54e91933-1027-4b0a-adbf-554b5ddf7ba5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9a6a8580>]}
[0m12:10:47.853709 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.simple_dbt_project.fct_user_events_incremental' (models/marts/fct_user_events_incremental.sql) depends on a source named 'raw.user_events' which was not found
[0m12:10:47.854844 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.89375496, "process_user_time": 2.482825, "process_kernel_time": 0.290318, "process_mem_max_rss": "121828", "process_in_blocks": "21200", "process_out_blocks": "1685", "command_success": false}
[0m12:10:47.855307 [debug] [MainThread]: Command `dbt run` failed at 12:10:47.855217 after 0.89 seconds
[0m12:10:47.855652 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9db3abb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9a052b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff99d05a30>]}
[0m12:10:47.856022 [debug] [MainThread]: Flushing usage events
[0m12:11:08.755528 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffae5c6fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffabbc1d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffabbc1610>]}


============================== 12:11:08.759595 | b7689d7b-3298-43f0-98bd-a88b02d842c4 ==============================
[0m12:11:08.759595 [info ] [MainThread]: Running with dbt=1.7.3
[0m12:11:08.760191 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '.', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --select stg_orders --profiles-dir .', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:11:08.933355 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b7689d7b-3298-43f0-98bd-a88b02d842c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffad440220>]}
[0m12:11:08.982301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b7689d7b-3298-43f0-98bd-a88b02d842c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffac41d670>]}
[0m12:11:08.982928 [info ] [MainThread]: Registered adapter: postgres=1.7.3
[0m12:11:08.987986 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m12:11:08.988675 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m12:11:08.989023 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'b7689d7b-3298-43f0-98bd-a88b02d842c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaaed4550>]}
[0m12:11:09.574322 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.simple_dbt_project.fct_user_events_incremental' (models/marts/fct_user_events_incremental.sql) depends on a source named 'raw.user_events' which was not found
[0m12:11:09.575371 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.84356344, "process_user_time": 2.338231, "process_kernel_time": 0.172017, "process_mem_max_rss": "122072", "process_out_blocks": "5", "command_success": false, "process_in_blocks": "0"}
[0m12:11:09.575815 [debug] [MainThread]: Command `dbt run` failed at 12:11:09.575713 after 0.84 seconds
[0m12:11:09.576137 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffae5c6fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa550b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa550c10>]}
[0m12:11:09.576438 [debug] [MainThread]: Flushing usage events
[0m12:11:38.697837 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb004df70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffad6c2790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffad6c2d00>]}


============================== 12:11:38.702284 | f3369c6d-d13b-42c6-82f1-9d16f2b750df ==============================
[0m12:11:38.702284 [info ] [MainThread]: Running with dbt=1.7.3
[0m12:11:38.702741 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '.', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select stg_orders --profiles-dir .', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:11:38.864177 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f3369c6d-d13b-42c6-82f1-9d16f2b750df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaef043a0>]}
[0m12:11:38.912654 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f3369c6d-d13b-42c6-82f1-9d16f2b750df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffad7ac970>]}
[0m12:11:38.913224 [info ] [MainThread]: Registered adapter: postgres=1.7.3
[0m12:11:38.918179 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m12:11:38.918894 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m12:11:38.919181 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'f3369c6d-d13b-42c6-82f1-9d16f2b750df', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffac9d9130>]}
[0m12:11:39.509437 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.simple_dbt_project.fct_user_events_incremental' (models/marts/fct_user_events_incremental.sql) depends on a source named 'raw.user_events' which was not found
[0m12:11:39.510414 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.8379602, "process_user_time": 2.350213, "process_kernel_time": 0.177393, "process_mem_max_rss": "122180", "process_out_blocks": "5", "command_success": false, "process_in_blocks": "0"}
[0m12:11:39.510821 [debug] [MainThread]: Command `dbt run` failed at 12:11:39.510722 after 0.84 seconds
[0m12:11:39.511126 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb004df70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffac2963a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffac2962e0>]}
[0m12:11:39.511393 [debug] [MainThread]: Flushing usage events
[0m12:12:04.459643 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91291e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e900280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e900e20>]}


============================== 12:12:04.464911 | c5f370ac-d96f-4b62-a9b5-aebde64167d8 ==============================
[0m12:12:04.464911 [info ] [MainThread]: Running with dbt=1.7.3
[0m12:12:04.465376 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '.', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select stg_orders --profiles-dir .', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m12:12:04.630372 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c5f370ac-d96f-4b62-a9b5-aebde64167d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8dd7c3d0>]}
[0m12:12:04.680021 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c5f370ac-d96f-4b62-a9b5-aebde64167d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e9c3ca0>]}
[0m12:12:04.680703 [info ] [MainThread]: Registered adapter: postgres=1.7.3
[0m12:12:04.685658 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m12:12:04.686438 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m12:12:04.686785 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'c5f370ac-d96f-4b62-a9b5-aebde64167d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8dc54220>]}
[0m12:12:05.300603 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c5f370ac-d96f-4b62-a9b5-aebde64167d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8d53beb0>]}
[0m12:12:05.312173 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c5f370ac-d96f-4b62-a9b5-aebde64167d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8d53bf40>]}
[0m12:12:05.312575 [info ] [MainThread]: Found 4 models, 5 tests, 1 source, 0 exposures, 0 metrics, 402 macros, 0 groups, 0 semantic models
[0m12:12:05.312975 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c5f370ac-d96f-4b62-a9b5-aebde64167d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8dd24fd0>]}
[0m12:12:05.313845 [info ] [MainThread]: 
[0m12:12:05.314420 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:12:05.315296 [debug] [ThreadPool]: Acquiring new postgres connection 'list_airflow'
[0m12:12:05.321823 [debug] [ThreadPool]: Using postgres connection "list_airflow"
[0m12:12:05.322339 [debug] [ThreadPool]: On list_airflow: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_airflow"} */

    select distinct nspname from pg_namespace
  
[0m12:12:05.322657 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:12:05.333870 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.0 seconds
[0m12:12:05.334977 [debug] [ThreadPool]: On list_airflow: Close
[0m12:12:05.336913 [debug] [ThreadPool]: Acquiring new postgres connection 'list_airflow_public'
[0m12:12:05.344634 [debug] [ThreadPool]: Using postgres connection "list_airflow_public"
[0m12:12:05.345423 [debug] [ThreadPool]: On list_airflow_public: BEGIN
[0m12:12:05.345783 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:12:05.349352 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m12:12:05.349974 [debug] [ThreadPool]: Using postgres connection "list_airflow_public"
[0m12:12:05.350244 [debug] [ThreadPool]: On list_airflow_public: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_airflow_public"} */
select
      'airflow' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'airflow' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'airflow' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m12:12:05.353337 [debug] [ThreadPool]: SQL status: SELECT 42 in 0.0 seconds
[0m12:12:05.354683 [debug] [ThreadPool]: On list_airflow_public: ROLLBACK
[0m12:12:05.355052 [debug] [ThreadPool]: On list_airflow_public: Close
[0m12:12:05.363344 [debug] [MainThread]: Using postgres connection "master"
[0m12:12:05.363803 [debug] [MainThread]: On master: BEGIN
[0m12:12:05.364049 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:12:05.366486 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:12:05.366778 [debug] [MainThread]: Using postgres connection "master"
[0m12:12:05.367058 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:12:05.368955 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m12:12:05.369719 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c5f370ac-d96f-4b62-a9b5-aebde64167d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8d4891f0>]}
[0m12:12:05.370055 [debug] [MainThread]: On master: ROLLBACK
[0m12:12:05.370380 [debug] [MainThread]: Using postgres connection "master"
[0m12:12:05.370601 [debug] [MainThread]: On master: BEGIN
[0m12:12:05.371047 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:12:05.371292 [debug] [MainThread]: On master: COMMIT
[0m12:12:05.371525 [debug] [MainThread]: Using postgres connection "master"
[0m12:12:05.371758 [debug] [MainThread]: On master: COMMIT
[0m12:12:05.372080 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m12:12:05.372310 [debug] [MainThread]: On master: Close
[0m12:12:05.372788 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:12:05.373182 [info ] [MainThread]: 
[0m12:12:05.379446 [debug] [Thread-1  ]: Began running node model.simple_dbt_project.stg_orders
[0m12:12:05.379989 [info ] [Thread-1  ]: 1 of 1 START sql view model public.stg_orders .................................. [RUN]
[0m12:12:05.380567 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_airflow_public, now model.simple_dbt_project.stg_orders)
[0m12:12:05.380914 [debug] [Thread-1  ]: Began compiling node model.simple_dbt_project.stg_orders
[0m12:12:05.386488 [debug] [Thread-1  ]: Writing injected SQL for node "model.simple_dbt_project.stg_orders"
[0m12:12:05.388956 [debug] [Thread-1  ]: Timing info for model.simple_dbt_project.stg_orders (compile): 12:12:05.381199 => 12:12:05.388725
[0m12:12:05.389300 [debug] [Thread-1  ]: Began executing node model.simple_dbt_project.stg_orders
[0m12:12:05.488141 [debug] [Thread-1  ]: Writing runtime sql for node "model.simple_dbt_project.stg_orders"
[0m12:12:05.493429 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:12:05.494463 [debug] [Thread-1  ]: On model.simple_dbt_project.stg_orders: BEGIN
[0m12:12:05.495163 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:12:05.529991 [debug] [Thread-1  ]: SQL status: BEGIN in 0.0 seconds
[0m12:12:05.533148 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:12:05.533535 [debug] [Thread-1  ]: On model.simple_dbt_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.stg_orders"} */

  create view "airflow"."public"."stg_orders__dbt_tmp"
    
    
  as (
    

-- Staging model to clean and standardize raw orders data
SELECT
    order_id,
    customer_id,
    CAST(order_date AS DATE) as order_date,
    status,
    amount,
    CURRENT_TIMESTAMP as loaded_at
FROM "airflow"."raw"."orders"  -- This would point to your raw orders table
  );
[0m12:12:05.541231 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.0 seconds
[0m12:12:05.549937 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:12:05.550477 [debug] [Thread-1  ]: On model.simple_dbt_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.stg_orders"} */
alter table "airflow"."public"."stg_orders__dbt_tmp" rename to "stg_orders"
[0m12:12:05.551685 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:12:05.568096 [debug] [Thread-1  ]: On model.simple_dbt_project.stg_orders: COMMIT
[0m12:12:05.568774 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:12:05.569091 [debug] [Thread-1  ]: On model.simple_dbt_project.stg_orders: COMMIT
[0m12:12:05.570095 [debug] [Thread-1  ]: SQL status: COMMIT in 0.0 seconds
[0m12:12:05.578162 [debug] [Thread-1  ]: Applying DROP to: "airflow"."public"."stg_orders__dbt_backup"
[0m12:12:05.581768 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:12:05.582155 [debug] [Thread-1  ]: On model.simple_dbt_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.stg_orders"} */
drop view if exists "airflow"."public"."stg_orders__dbt_backup" cascade
[0m12:12:05.582747 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.0 seconds
[0m12:12:05.583912 [debug] [Thread-1  ]: Timing info for model.simple_dbt_project.stg_orders (execute): 12:12:05.389485 => 12:12:05.583742
[0m12:12:05.584293 [debug] [Thread-1  ]: On model.simple_dbt_project.stg_orders: Close
[0m12:12:05.585113 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c5f370ac-d96f-4b62-a9b5-aebde64167d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8d0ae190>]}
[0m12:12:05.586155 [info ] [Thread-1  ]: 1 of 1 OK created sql view model public.stg_orders ............................. [[32mCREATE VIEW[0m in 0.20s]
[0m12:12:05.587790 [debug] [Thread-1  ]: Finished running node model.simple_dbt_project.stg_orders
[0m12:12:05.589333 [debug] [MainThread]: Using postgres connection "master"
[0m12:12:05.589635 [debug] [MainThread]: On master: BEGIN
[0m12:12:05.589956 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:12:05.594392 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:12:05.594871 [debug] [MainThread]: On master: COMMIT
[0m12:12:05.595217 [debug] [MainThread]: Using postgres connection "master"
[0m12:12:05.595486 [debug] [MainThread]: On master: COMMIT
[0m12:12:05.595822 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m12:12:05.596149 [debug] [MainThread]: On master: Close
[0m12:12:05.596774 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:12:05.597253 [debug] [MainThread]: Connection 'list_airflow' was properly closed.
[0m12:12:05.597554 [debug] [MainThread]: Connection 'model.simple_dbt_project.stg_orders' was properly closed.
[0m12:12:05.598015 [info ] [MainThread]: 
[0m12:12:05.598401 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.28 seconds (0.28s).
[0m12:12:05.599143 [debug] [MainThread]: Command end result
[0m12:12:05.746571 [info ] [MainThread]: 
[0m12:12:05.748372 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:12:05.749997 [info ] [MainThread]: 
[0m12:12:05.750608 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m12:12:05.753921 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.320488, "process_user_time": 2.756949, "process_kernel_time": 0.285519, "process_mem_max_rss": "128696", "process_out_blocks": "2387", "process_in_blocks": "0"}
[0m12:12:05.755822 [debug] [MainThread]: Command `dbt run` succeeded at 12:12:05.755263 after 1.32 seconds
[0m12:12:05.757237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91291e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8dd24fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8d53bee0>]}
[0m12:12:05.758556 [debug] [MainThread]: Flushing usage events
[0m12:15:03.052538 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8022dbb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d8df430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d8dfee0>]}


============================== 12:15:03.056771 | dde9f24d-940b-4c17-89a7-c8276086b0be ==============================
[0m12:15:03.056771 [info ] [MainThread]: Running with dbt=1.7.3
[0m12:15:03.057320 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '.', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select stg_orders --profiles-dir .', 'send_anonymous_usage_stats': 'True'}
[0m12:15:03.212557 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dde9f24d-940b-4c17-89a7-c8276086b0be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8059ef70>]}
[0m12:15:03.267917 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dde9f24d-940b-4c17-89a7-c8276086b0be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8290fdc0>]}
[0m12:15:03.268675 [info ] [MainThread]: Registered adapter: postgres=1.7.3
[0m12:15:03.274511 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m12:15:03.306210 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:15:03.306762 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:15:03.311498 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dde9f24d-940b-4c17-89a7-c8276086b0be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c979ee0>]}
[0m12:15:03.322534 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dde9f24d-940b-4c17-89a7-c8276086b0be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ca3fd60>]}
[0m12:15:03.322939 [info ] [MainThread]: Found 4 models, 5 tests, 1 source, 0 exposures, 0 metrics, 402 macros, 0 groups, 0 semantic models
[0m12:15:03.323259 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dde9f24d-940b-4c17-89a7-c8276086b0be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ca3fee0>]}
[0m12:15:03.324224 [info ] [MainThread]: 
[0m12:15:03.324899 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:15:03.325807 [debug] [ThreadPool]: Acquiring new postgres connection 'list_airflow'
[0m12:15:03.334831 [debug] [ThreadPool]: Using postgres connection "list_airflow"
[0m12:15:03.335271 [debug] [ThreadPool]: On list_airflow: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_airflow"} */

    select distinct nspname from pg_namespace
  
[0m12:15:03.335545 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:15:03.345156 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.0 seconds
[0m12:15:03.346283 [debug] [ThreadPool]: On list_airflow: Close
[0m12:15:03.347742 [debug] [ThreadPool]: Acquiring new postgres connection 'list_airflow_public'
[0m12:15:03.353586 [debug] [ThreadPool]: Using postgres connection "list_airflow_public"
[0m12:15:03.354035 [debug] [ThreadPool]: On list_airflow_public: BEGIN
[0m12:15:03.354331 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:15:03.357816 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m12:15:03.358344 [debug] [ThreadPool]: Using postgres connection "list_airflow_public"
[0m12:15:03.358631 [debug] [ThreadPool]: On list_airflow_public: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_airflow_public"} */
select
      'airflow' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'airflow' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'airflow' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m12:15:03.363150 [debug] [ThreadPool]: SQL status: SELECT 42 in 0.0 seconds
[0m12:15:03.364821 [debug] [ThreadPool]: On list_airflow_public: ROLLBACK
[0m12:15:03.365872 [debug] [ThreadPool]: On list_airflow_public: Close
[0m12:15:03.374848 [debug] [MainThread]: Using postgres connection "master"
[0m12:15:03.375328 [debug] [MainThread]: On master: BEGIN
[0m12:15:03.375632 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:15:03.379358 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:15:03.379821 [debug] [MainThread]: Using postgres connection "master"
[0m12:15:03.380194 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:15:03.383881 [debug] [MainThread]: SQL status: SELECT 0 in 0.0 seconds
[0m12:15:03.385217 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dde9f24d-940b-4c17-89a7-c8276086b0be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c980430>]}
[0m12:15:03.385849 [debug] [MainThread]: On master: ROLLBACK
[0m12:15:03.386555 [debug] [MainThread]: Using postgres connection "master"
[0m12:15:03.386989 [debug] [MainThread]: On master: BEGIN
[0m12:15:03.387722 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:15:03.388573 [debug] [MainThread]: On master: COMMIT
[0m12:15:03.389378 [debug] [MainThread]: Using postgres connection "master"
[0m12:15:03.389951 [debug] [MainThread]: On master: COMMIT
[0m12:15:03.390735 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m12:15:03.391325 [debug] [MainThread]: On master: Close
[0m12:15:03.392683 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:15:03.393115 [info ] [MainThread]: 
[0m12:15:03.401890 [debug] [Thread-1  ]: Began running node model.simple_dbt_project.stg_orders
[0m12:15:03.402479 [info ] [Thread-1  ]: 1 of 1 START sql view model public.stg_orders .................................. [RUN]
[0m12:15:03.403144 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_airflow_public, now model.simple_dbt_project.stg_orders)
[0m12:15:03.403571 [debug] [Thread-1  ]: Began compiling node model.simple_dbt_project.stg_orders
[0m12:15:03.411033 [debug] [Thread-1  ]: Writing injected SQL for node "model.simple_dbt_project.stg_orders"
[0m12:15:03.412835 [debug] [Thread-1  ]: Timing info for model.simple_dbt_project.stg_orders (compile): 12:15:03.403794 => 12:15:03.412586
[0m12:15:03.413203 [debug] [Thread-1  ]: Began executing node model.simple_dbt_project.stg_orders
[0m12:15:03.554223 [debug] [Thread-1  ]: Writing runtime sql for node "model.simple_dbt_project.stg_orders"
[0m12:15:03.556494 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:15:03.557174 [debug] [Thread-1  ]: On model.simple_dbt_project.stg_orders: BEGIN
[0m12:15:03.557791 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:15:03.564831 [debug] [Thread-1  ]: SQL status: BEGIN in 0.0 seconds
[0m12:15:03.565431 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:15:03.565858 [debug] [Thread-1  ]: On model.simple_dbt_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.stg_orders"} */

  create view "airflow"."public"."stg_orders__dbt_tmp"
    
    
  as (
    

-- Staging model to clean and standardize raw orders data
SELECT
    order_id,
    customer_id,
    CAST(order_date AS DATE) as order_date,
    status,
    amount,
    CURRENT_TIMESTAMP as loaded_at
FROM "airflow"."raw"."orders"  -- This would point to your raw orders table
  );
[0m12:15:03.571083 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.0 seconds
[0m12:15:03.577054 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:15:03.577635 [debug] [Thread-1  ]: On model.simple_dbt_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.stg_orders"} */
alter table "airflow"."public"."stg_orders__dbt_tmp" rename to "stg_orders"
[0m12:15:03.578856 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:15:03.592636 [debug] [Thread-1  ]: On model.simple_dbt_project.stg_orders: COMMIT
[0m12:15:03.593242 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:15:03.593658 [debug] [Thread-1  ]: On model.simple_dbt_project.stg_orders: COMMIT
[0m12:15:03.594816 [debug] [Thread-1  ]: SQL status: COMMIT in 0.0 seconds
[0m12:15:03.601775 [debug] [Thread-1  ]: Applying DROP to: "airflow"."public"."stg_orders__dbt_backup"
[0m12:15:03.605660 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:15:03.606186 [debug] [Thread-1  ]: On model.simple_dbt_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.stg_orders"} */
drop view if exists "airflow"."public"."stg_orders__dbt_backup" cascade
[0m12:15:03.606958 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.0 seconds
[0m12:15:03.608466 [debug] [Thread-1  ]: Timing info for model.simple_dbt_project.stg_orders (execute): 12:15:03.413427 => 12:15:03.608265
[0m12:15:03.608990 [debug] [Thread-1  ]: On model.simple_dbt_project.stg_orders: Close
[0m12:15:03.609984 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dde9f24d-940b-4c17-89a7-c8276086b0be', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7bf6e700>]}
[0m12:15:03.610657 [info ] [Thread-1  ]: 1 of 1 OK created sql view model public.stg_orders ............................. [[32mCREATE VIEW[0m in 0.21s]
[0m12:15:03.611665 [debug] [Thread-1  ]: Finished running node model.simple_dbt_project.stg_orders
[0m12:15:03.613674 [debug] [MainThread]: Using postgres connection "master"
[0m12:15:03.614218 [debug] [MainThread]: On master: BEGIN
[0m12:15:03.614547 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:15:03.618428 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:15:03.619405 [debug] [MainThread]: On master: COMMIT
[0m12:15:03.620186 [debug] [MainThread]: Using postgres connection "master"
[0m12:15:03.620688 [debug] [MainThread]: On master: COMMIT
[0m12:15:03.621232 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m12:15:03.621651 [debug] [MainThread]: On master: Close
[0m12:15:03.622788 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:15:03.623606 [debug] [MainThread]: Connection 'list_airflow' was properly closed.
[0m12:15:03.624023 [debug] [MainThread]: Connection 'model.simple_dbt_project.stg_orders' was properly closed.
[0m12:15:03.624451 [info ] [MainThread]: 
[0m12:15:03.625670 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 0.30 seconds (0.30s).
[0m12:15:03.627239 [debug] [MainThread]: Command end result
[0m12:15:03.637402 [info ] [MainThread]: 
[0m12:15:03.638170 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:15:03.640476 [info ] [MainThread]: 
[0m12:15:03.641187 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m12:15:03.643814 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.61616594, "process_user_time": 2.127671, "process_kernel_time": 0.383245, "process_mem_max_rss": "121916", "process_out_blocks": "3288", "process_in_blocks": "0"}
[0m12:15:03.644578 [debug] [MainThread]: Command `dbt run` succeeded at 12:15:03.644446 after 0.62 seconds
[0m12:15:03.645254 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8022dbb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7cb67820>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8059ef70>]}
[0m12:15:03.646235 [debug] [MainThread]: Flushing usage events
[0m12:18:01.964098 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b1c7f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88801730>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88801c10>]}


============================== 12:18:01.968522 | 72d17d3c-b310-471d-9a69-cf79b82b17e2 ==============================
[0m12:18:01.968522 [info ] [MainThread]: Running with dbt=1.7.3
[0m12:18:01.969203 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '.', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir .', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m12:18:02.111668 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '72d17d3c-b310-471d-9a69-cf79b82b17e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff888c5df0>]}
[0m12:18:02.159761 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '72d17d3c-b310-471d-9a69-cf79b82b17e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8d86e370>]}
[0m12:18:02.160347 [info ] [MainThread]: Registered adapter: postgres=1.7.3
[0m12:18:02.165641 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m12:18:02.187547 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:18:02.187879 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:18:02.191915 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '72d17d3c-b310-471d-9a69-cf79b82b17e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87988e20>]}
[0m12:18:02.202613 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '72d17d3c-b310-471d-9a69-cf79b82b17e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87a56c10>]}
[0m12:18:02.203001 [info ] [MainThread]: Found 4 models, 5 tests, 1 source, 0 exposures, 0 metrics, 402 macros, 0 groups, 0 semantic models
[0m12:18:02.203636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '72d17d3c-b310-471d-9a69-cf79b82b17e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87a56d90>]}
[0m12:18:02.204825 [info ] [MainThread]: 
[0m12:18:02.205558 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:18:02.206525 [debug] [ThreadPool]: Acquiring new postgres connection 'list_airflow'
[0m12:18:02.213355 [debug] [ThreadPool]: Using postgres connection "list_airflow"
[0m12:18:02.213689 [debug] [ThreadPool]: On list_airflow: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_airflow"} */

    select distinct nspname from pg_namespace
  
[0m12:18:02.213975 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:18:02.219383 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.0 seconds
[0m12:18:02.220686 [debug] [ThreadPool]: On list_airflow: Close
[0m12:18:02.222360 [debug] [ThreadPool]: Acquiring new postgres connection 'list_airflow_public'
[0m12:18:02.227026 [debug] [ThreadPool]: Using postgres connection "list_airflow_public"
[0m12:18:02.227422 [debug] [ThreadPool]: On list_airflow_public: BEGIN
[0m12:18:02.227736 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:18:02.231272 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m12:18:02.231814 [debug] [ThreadPool]: Using postgres connection "list_airflow_public"
[0m12:18:02.232129 [debug] [ThreadPool]: On list_airflow_public: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_airflow_public"} */
select
      'airflow' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'airflow' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'airflow' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m12:18:02.234619 [debug] [ThreadPool]: SQL status: SELECT 43 in 0.0 seconds
[0m12:18:02.236035 [debug] [ThreadPool]: On list_airflow_public: ROLLBACK
[0m12:18:02.236423 [debug] [ThreadPool]: On list_airflow_public: Close
[0m12:18:02.243685 [debug] [MainThread]: Using postgres connection "master"
[0m12:18:02.244043 [debug] [MainThread]: On master: BEGIN
[0m12:18:02.244289 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:18:02.246569 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:18:02.246865 [debug] [MainThread]: Using postgres connection "master"
[0m12:18:02.247147 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:18:02.251955 [debug] [MainThread]: SQL status: SELECT 1 in 0.0 seconds
[0m12:18:02.253024 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '72d17d3c-b310-471d-9a69-cf79b82b17e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87988f70>]}
[0m12:18:02.253511 [debug] [MainThread]: On master: ROLLBACK
[0m12:18:02.253941 [debug] [MainThread]: Using postgres connection "master"
[0m12:18:02.254193 [debug] [MainThread]: On master: BEGIN
[0m12:18:02.254617 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:18:02.254862 [debug] [MainThread]: On master: COMMIT
[0m12:18:02.255089 [debug] [MainThread]: Using postgres connection "master"
[0m12:18:02.255309 [debug] [MainThread]: On master: COMMIT
[0m12:18:02.255645 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m12:18:02.255933 [debug] [MainThread]: On master: Close
[0m12:18:02.256445 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:18:02.256850 [info ] [MainThread]: 
[0m12:18:02.264644 [debug] [Thread-1  ]: Began running node model.simple_dbt_project.my_first_model
[0m12:18:02.265087 [debug] [Thread-2  ]: Began running node model.simple_dbt_project.stg_orders
[0m12:18:02.265492 [info ] [Thread-1  ]: 1 of 4 START sql view model public.my_first_model .............................. [RUN]
[0m12:18:02.266032 [info ] [Thread-2  ]: 2 of 4 START sql view model public.stg_orders .................................. [RUN]
[0m12:18:02.267405 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_airflow_public, now model.simple_dbt_project.my_first_model)
[0m12:18:02.268008 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly list_airflow, now model.simple_dbt_project.stg_orders)
[0m12:18:02.268363 [debug] [Thread-1  ]: Began compiling node model.simple_dbt_project.my_first_model
[0m12:18:02.268676 [debug] [Thread-2  ]: Began compiling node model.simple_dbt_project.stg_orders
[0m12:18:02.273395 [debug] [Thread-1  ]: Writing injected SQL for node "model.simple_dbt_project.my_first_model"
[0m12:18:02.275672 [debug] [Thread-2  ]: Writing injected SQL for node "model.simple_dbt_project.stg_orders"
[0m12:18:02.277056 [debug] [Thread-2  ]: Timing info for model.simple_dbt_project.stg_orders (compile): 12:18:02.273671 => 12:18:02.276891
[0m12:18:02.277381 [debug] [Thread-2  ]: Began executing node model.simple_dbt_project.stg_orders
[0m12:18:02.291470 [debug] [Thread-1  ]: Timing info for model.simple_dbt_project.my_first_model (compile): 12:18:02.268908 => 12:18:02.291011
[0m12:18:02.297901 [debug] [Thread-1  ]: Began executing node model.simple_dbt_project.my_first_model
[0m12:18:02.303731 [debug] [Thread-2  ]: Writing runtime sql for node "model.simple_dbt_project.stg_orders"
[0m12:18:02.307201 [debug] [Thread-1  ]: Writing runtime sql for node "model.simple_dbt_project.my_first_model"
[0m12:18:02.308703 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:18:02.308999 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: BEGIN
[0m12:18:02.309291 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m12:18:02.309584 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:18:02.310080 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: BEGIN
[0m12:18:02.310813 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:18:02.313115 [debug] [Thread-2  ]: SQL status: BEGIN in 0.0 seconds
[0m12:18:02.313578 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:18:02.313958 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.stg_orders"} */

  create view "airflow"."public"."stg_orders__dbt_tmp"
    
    
  as (
    

-- Staging model to clean and standardize raw orders data
SELECT
    order_id,
    customer_id,
    CAST(order_date AS DATE) as order_date,
    status,
    amount,
    CURRENT_TIMESTAMP as loaded_at
FROM "airflow"."raw"."orders"  -- This would point to your raw orders table
  );
[0m12:18:02.314302 [debug] [Thread-1  ]: SQL status: BEGIN in 0.0 seconds
[0m12:18:02.314736 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:18:02.315148 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.my_first_model"} */

  create view "airflow"."public"."my_first_model__dbt_tmp"
    
    
  as (
    -- Simple example model
SELECT 1 as id, 'Example' as name
UNION ALL
SELECT 2 as id, 'Test' as name
  );
[0m12:18:02.316075 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.0 seconds
[0m12:18:02.316436 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.0 seconds
[0m12:18:02.321070 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:18:02.323353 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.stg_orders"} */
alter table "airflow"."public"."stg_orders" rename to "stg_orders__dbt_backup"
[0m12:18:02.323048 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:18:02.323768 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.my_first_model"} */
alter table "airflow"."public"."my_first_model__dbt_tmp" rename to "my_first_model"
[0m12:18:02.324060 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:18:02.326057 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:18:02.326550 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.stg_orders"} */
alter table "airflow"."public"."stg_orders__dbt_tmp" rename to "stg_orders"
[0m12:18:02.326323 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:18:02.333815 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:18:02.337217 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: COMMIT
[0m12:18:02.337541 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:18:02.337810 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: COMMIT
[0m12:18:02.335303 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: COMMIT
[0m12:18:02.338266 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:18:02.338914 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: COMMIT
[0m12:18:02.338694 [debug] [Thread-2  ]: SQL status: COMMIT in 0.0 seconds
[0m12:18:02.342754 [debug] [Thread-2  ]: Applying DROP to: "airflow"."public"."stg_orders__dbt_backup"
[0m12:18:02.343036 [debug] [Thread-1  ]: SQL status: COMMIT in 0.0 seconds
[0m12:18:02.345572 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:18:02.347441 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.stg_orders"} */
drop view if exists "airflow"."public"."stg_orders__dbt_backup" cascade
[0m12:18:02.347146 [debug] [Thread-1  ]: Applying DROP to: "airflow"."public"."my_first_model__dbt_backup"
[0m12:18:02.348037 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:18:02.348354 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.my_first_model"} */
drop view if exists "airflow"."public"."my_first_model__dbt_backup" cascade
[0m12:18:02.348898 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.0 seconds
[0m12:18:02.350048 [debug] [Thread-1  ]: Timing info for model.simple_dbt_project.my_first_model (execute): 12:18:02.303995 => 12:18:02.349905
[0m12:18:02.350331 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: Close
[0m12:18:02.349174 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.0 seconds
[0m12:18:02.350939 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72d17d3c-b310-471d-9a69-cf79b82b17e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8785a2e0>]}
[0m12:18:02.352446 [debug] [Thread-2  ]: Timing info for model.simple_dbt_project.stg_orders (execute): 12:18:02.277617 => 12:18:02.352179
[0m12:18:02.353974 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: Close
[0m12:18:02.354880 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72d17d3c-b310-471d-9a69-cf79b82b17e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87899f10>]}
[0m12:18:02.355498 [info ] [Thread-2  ]: 2 of 4 OK created sql view model public.stg_orders ............................. [[32mCREATE VIEW[0m in 0.09s]
[0m12:18:02.356032 [debug] [Thread-2  ]: Finished running node model.simple_dbt_project.stg_orders
[0m12:18:02.353333 [info ] [Thread-1  ]: 1 of 4 OK created sql view model public.my_first_model ......................... [[32mCREATE VIEW[0m in 0.08s]
[0m12:18:02.356625 [debug] [Thread-1  ]: Finished running node model.simple_dbt_project.my_first_model
[0m12:18:02.357102 [debug] [Thread-4  ]: Began running node model.simple_dbt_project.fct_customer_purchase_patterns
[0m12:18:02.357415 [debug] [Thread-3  ]: Began running node model.simple_dbt_project.fct_daily_sales
[0m12:18:02.357770 [info ] [Thread-4  ]: 3 of 4 START sql table model public.fct_customer_purchase_patterns ............. [RUN]
[0m12:18:02.358166 [info ] [Thread-3  ]: 4 of 4 START sql table model public.fct_daily_sales ............................ [RUN]
[0m12:18:02.358856 [debug] [Thread-4  ]: Acquiring new postgres connection 'model.simple_dbt_project.fct_customer_purchase_patterns'
[0m12:18:02.359406 [debug] [Thread-3  ]: Acquiring new postgres connection 'model.simple_dbt_project.fct_daily_sales'
[0m12:18:02.359751 [debug] [Thread-4  ]: Began compiling node model.simple_dbt_project.fct_customer_purchase_patterns
[0m12:18:02.360058 [debug] [Thread-3  ]: Began compiling node model.simple_dbt_project.fct_daily_sales
[0m12:18:02.362635 [debug] [Thread-4  ]: Writing injected SQL for node "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:18:02.365212 [debug] [Thread-3  ]: Writing injected SQL for node "model.simple_dbt_project.fct_daily_sales"
[0m12:18:02.366760 [debug] [Thread-4  ]: Timing info for model.simple_dbt_project.fct_customer_purchase_patterns (compile): 12:18:02.360262 => 12:18:02.366587
[0m12:18:02.367089 [debug] [Thread-4  ]: Began executing node model.simple_dbt_project.fct_customer_purchase_patterns
[0m12:18:02.383970 [debug] [Thread-4  ]: Writing runtime sql for node "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:18:02.384527 [debug] [Thread-3  ]: Timing info for model.simple_dbt_project.fct_daily_sales (compile): 12:18:02.362879 => 12:18:02.384326
[0m12:18:02.384992 [debug] [Thread-3  ]: Began executing node model.simple_dbt_project.fct_daily_sales
[0m12:18:02.388561 [debug] [Thread-3  ]: Writing runtime sql for node "model.simple_dbt_project.fct_daily_sales"
[0m12:18:02.389451 [debug] [Thread-4  ]: Using postgres connection "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:18:02.389769 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: BEGIN
[0m12:18:02.390051 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m12:18:02.390365 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:18:02.391725 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: BEGIN
[0m12:18:02.392252 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m12:18:02.393815 [debug] [Thread-4  ]: SQL status: BEGIN in 0.0 seconds
[0m12:18:02.394152 [debug] [Thread-4  ]: Using postgres connection "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:18:02.394494 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_customer_purchase_patterns"} */

  
    

  create  table "airflow"."public"."fct_customer_purchase_patterns__dbt_tmp"
  
  
    as
  
  (
    

WITH customer_purchases AS (
    SELECT
        customer_id,
        order_date,
        amount,
        -- Common interview question: calculate days between purchases
        LAG(order_date) OVER (
            PARTITION BY customer_id 
            ORDER BY order_date
        ) as previous_order_date,
        -- Calculate running total
        SUM(amount) OVER (
            PARTITION BY customer_id 
            ORDER BY order_date
            ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
        ) as lifetime_spend
    FROM "airflow"."public"."stg_orders"
    WHERE status = 'completed'
),

purchase_metrics AS (
    SELECT
        customer_id,
        order_date,
        amount,
        previous_order_date,
        lifetime_spend,
        -- Common interview question: handle NULL for first purchase
        COALESCE(
            DATE_DIFF('day', previous_order_date, order_date),
            0
        ) as days_since_previous_order
    FROM customer_purchases
)

SELECT
    customer_id,
    COUNT(*) as total_orders,
    AVG(amount) as avg_order_value,
    AVG(days_since_previous_order) as avg_days_between_orders,
    MAX(lifetime_spend) as total_lifetime_spend,
    -- Common interview question: categorize customers
    CASE 
        WHEN MAX(lifetime_spend) > 1000 THEN 'high_value'
        WHEN MAX(lifetime_spend) > 500 THEN 'medium_value'
        ELSE 'low_value'
    END as customer_segment
FROM purchase_metrics
GROUP BY 1
  );
  
[0m12:18:02.394916 [debug] [Thread-3  ]: SQL status: BEGIN in 0.0 seconds
[0m12:18:02.395290 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:18:02.395679 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_daily_sales"} */

  
    

  create  table "airflow"."public"."fct_daily_sales__dbt_tmp"
  
  
    as
  
  (
    

WITH daily_sales AS (
    SELECT
        DATE_TRUNC('day', order_date) as date,
        COUNT(DISTINCT order_id) as total_orders,
        COUNT(DISTINCT customer_id) as unique_customers,
        SUM(amount) as total_amount
    FROM "airflow"."public"."stg_orders"
    WHERE status = 'completed'
    GROUP BY 1
)

SELECT
    date,
    total_orders,
    unique_customers,
    total_amount,
    total_amount / NULLIF(total_orders, 0) as avg_order_value,
    total_amount / NULLIF(unique_customers, 0) as avg_customer_spend
FROM daily_sales
  );
  
[0m12:18:02.396232 [debug] [Thread-4  ]: Postgres adapter: Postgres error: function date_diff(unknown, date, date) does not exist
LINE 43:             DATE_DIFF('day', previous_order_date, order_date...
                     ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.

[0m12:18:02.396561 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: ROLLBACK
[0m12:18:02.397107 [debug] [Thread-4  ]: Timing info for model.simple_dbt_project.fct_customer_purchase_patterns (execute): 12:18:02.367296 => 12:18:02.396922
[0m12:18:02.397456 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: Close
[0m12:18:02.401860 [debug] [Thread-4  ]: Database Error in model fct_customer_purchase_patterns (models/marts/fct_customer_purchase_patterns.sql)
  function date_diff(unknown, date, date) does not exist
  LINE 43:             DATE_DIFF('day', previous_order_date, order_date...
                       ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled Code at target/run/simple_dbt_project/models/marts/fct_customer_purchase_patterns.sql
[0m12:18:02.402243 [debug] [Thread-3  ]: SQL status: SELECT 2 in 0.0 seconds
[0m12:18:02.402568 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72d17d3c-b310-471d-9a69-cf79b82b17e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86f58fd0>]}
[0m12:18:02.405235 [error] [Thread-4  ]: 3 of 4 ERROR creating sql table model public.fct_customer_purchase_patterns .... [[31mERROR[0m in 0.04s]
[0m12:18:02.405724 [debug] [Thread-4  ]: Finished running node model.simple_dbt_project.fct_customer_purchase_patterns
[0m12:18:02.404774 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:18:02.406214 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_daily_sales"} */
alter table "airflow"."public"."fct_daily_sales__dbt_tmp" rename to "fct_daily_sales"
[0m12:18:02.406727 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:18:02.409812 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: COMMIT
[0m12:18:02.410136 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:18:02.410402 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: COMMIT
[0m12:18:02.411043 [debug] [Thread-3  ]: SQL status: COMMIT in 0.0 seconds
[0m12:18:02.412952 [debug] [Thread-3  ]: Applying DROP to: "airflow"."public"."fct_daily_sales__dbt_backup"
[0m12:18:02.414668 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:18:02.414993 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_daily_sales"} */
drop table if exists "airflow"."public"."fct_daily_sales__dbt_backup" cascade
[0m12:18:02.415415 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.0 seconds
[0m12:18:02.416409 [debug] [Thread-3  ]: Timing info for model.simple_dbt_project.fct_daily_sales (execute): 12:18:02.385248 => 12:18:02.416262
[0m12:18:02.416824 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: Close
[0m12:18:02.417621 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72d17d3c-b310-471d-9a69-cf79b82b17e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86f519d0>]}
[0m12:18:02.418475 [info ] [Thread-3  ]: 4 of 4 OK created sql table model public.fct_daily_sales ....................... [[32mSELECT 2[0m in 0.06s]
[0m12:18:02.419245 [debug] [Thread-3  ]: Finished running node model.simple_dbt_project.fct_daily_sales
[0m12:18:02.420869 [debug] [MainThread]: Using postgres connection "master"
[0m12:18:02.421270 [debug] [MainThread]: On master: BEGIN
[0m12:18:02.421556 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:18:02.424249 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:18:02.424607 [debug] [MainThread]: On master: COMMIT
[0m12:18:02.425170 [debug] [MainThread]: Using postgres connection "master"
[0m12:18:02.425451 [debug] [MainThread]: On master: COMMIT
[0m12:18:02.425998 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m12:18:02.426288 [debug] [MainThread]: On master: Close
[0m12:18:02.426839 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:18:02.427130 [debug] [MainThread]: Connection 'model.simple_dbt_project.stg_orders' was properly closed.
[0m12:18:02.427398 [debug] [MainThread]: Connection 'model.simple_dbt_project.my_first_model' was properly closed.
[0m12:18:02.427642 [debug] [MainThread]: Connection 'model.simple_dbt_project.fct_customer_purchase_patterns' was properly closed.
[0m12:18:02.427858 [debug] [MainThread]: Connection 'model.simple_dbt_project.fct_daily_sales' was properly closed.
[0m12:18:02.428126 [info ] [MainThread]: 
[0m12:18:02.428434 [info ] [MainThread]: Finished running 2 view models, 2 table models in 0 hours 0 minutes and 0.22 seconds (0.22s).
[0m12:18:02.429286 [debug] [MainThread]: Command end result
[0m12:18:02.438224 [info ] [MainThread]: 
[0m12:18:02.438628 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m12:18:02.438947 [info ] [MainThread]: 
[0m12:18:02.439350 [error] [MainThread]:   Database Error in model fct_customer_purchase_patterns (models/marts/fct_customer_purchase_patterns.sql)
  function date_diff(unknown, date, date) does not exist
  LINE 43:             DATE_DIFF('day', previous_order_date, order_date...
                       ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled Code at target/run/simple_dbt_project/models/marts/fct_customer_purchase_patterns.sql
[0m12:18:02.439689 [info ] [MainThread]: 
[0m12:18:02.440099 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m12:18:02.440891 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.50172555, "process_user_time": 1.920695, "process_kernel_time": 0.175245, "process_mem_max_rss": "182340", "process_out_blocks": "1659", "command_success": false, "process_in_blocks": "0"}
[0m12:18:02.441323 [debug] [MainThread]: Command `dbt run` failed at 12:18:02.441229 after 0.50 seconds
[0m12:18:02.441651 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b1c7f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8d86e370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86f92730>]}
[0m12:18:02.441959 [debug] [MainThread]: Flushing usage events
[0m12:23:06.000782 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa13cebb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9ea41d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9ea41610>]}


============================== 12:23:06.005695 | 6593238f-9034-49d4-aca3-f6db781750ac ==============================
[0m12:23:06.005695 [info ] [MainThread]: Running with dbt=1.7.3
[0m12:23:06.006337 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '.', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir .', 'send_anonymous_usage_stats': 'True'}
[0m12:23:06.149671 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6593238f-9034-49d4-aca3-f6db781750ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa0287100>]}
[0m12:23:06.199233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6593238f-9034-49d4-aca3-f6db781750ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9de199d0>]}
[0m12:23:06.199892 [info ] [MainThread]: Registered adapter: postgres=1.7.3
[0m12:23:06.205978 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m12:23:06.230505 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:23:06.230907 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:23:06.235124 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6593238f-9034-49d4-aca3-f6db781750ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9db88ee0>]}
[0m12:23:06.245522 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6593238f-9034-49d4-aca3-f6db781750ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9dc56cd0>]}
[0m12:23:06.245905 [info ] [MainThread]: Found 4 models, 5 tests, 1 source, 0 exposures, 0 metrics, 402 macros, 0 groups, 0 semantic models
[0m12:23:06.246198 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6593238f-9034-49d4-aca3-f6db781750ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9dc56e50>]}
[0m12:23:06.247221 [info ] [MainThread]: 
[0m12:23:06.247781 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:23:06.248762 [debug] [ThreadPool]: Acquiring new postgres connection 'list_airflow'
[0m12:23:06.255806 [debug] [ThreadPool]: Using postgres connection "list_airflow"
[0m12:23:06.256196 [debug] [ThreadPool]: On list_airflow: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_airflow"} */

    select distinct nspname from pg_namespace
  
[0m12:23:06.256599 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:23:06.264849 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.0 seconds
[0m12:23:06.265847 [debug] [ThreadPool]: On list_airflow: Close
[0m12:23:06.267179 [debug] [ThreadPool]: Acquiring new postgres connection 'list_airflow_public'
[0m12:23:06.271616 [debug] [ThreadPool]: Using postgres connection "list_airflow_public"
[0m12:23:06.271936 [debug] [ThreadPool]: On list_airflow_public: BEGIN
[0m12:23:06.272181 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:23:06.275281 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m12:23:06.275674 [debug] [ThreadPool]: Using postgres connection "list_airflow_public"
[0m12:23:06.275954 [debug] [ThreadPool]: On list_airflow_public: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_airflow_public"} */
select
      'airflow' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'airflow' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'airflow' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m12:23:06.278561 [debug] [ThreadPool]: SQL status: SELECT 45 in 0.0 seconds
[0m12:23:06.279866 [debug] [ThreadPool]: On list_airflow_public: ROLLBACK
[0m12:23:06.280229 [debug] [ThreadPool]: On list_airflow_public: Close
[0m12:23:06.287707 [debug] [MainThread]: Using postgres connection "master"
[0m12:23:06.288083 [debug] [MainThread]: On master: BEGIN
[0m12:23:06.288346 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:23:06.290455 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:23:06.290771 [debug] [MainThread]: Using postgres connection "master"
[0m12:23:06.291056 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:23:06.295437 [debug] [MainThread]: SQL status: SELECT 1 in 0.0 seconds
[0m12:23:06.296245 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6593238f-9034-49d4-aca3-f6db781750ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9dd78f10>]}
[0m12:23:06.296611 [debug] [MainThread]: On master: ROLLBACK
[0m12:23:06.296965 [debug] [MainThread]: Using postgres connection "master"
[0m12:23:06.297283 [debug] [MainThread]: On master: BEGIN
[0m12:23:06.297716 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:23:06.297964 [debug] [MainThread]: On master: COMMIT
[0m12:23:06.298188 [debug] [MainThread]: Using postgres connection "master"
[0m12:23:06.298408 [debug] [MainThread]: On master: COMMIT
[0m12:23:06.298717 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m12:23:06.298962 [debug] [MainThread]: On master: Close
[0m12:23:06.299442 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:23:06.299762 [info ] [MainThread]: 
[0m12:23:06.305225 [debug] [Thread-1  ]: Began running node model.simple_dbt_project.my_first_model
[0m12:23:06.305594 [debug] [Thread-2  ]: Began running node model.simple_dbt_project.stg_orders
[0m12:23:06.305980 [info ] [Thread-1  ]: 1 of 4 START sql view model public.my_first_model .............................. [RUN]
[0m12:23:06.306378 [info ] [Thread-2  ]: 2 of 4 START sql view model public.stg_orders .................................. [RUN]
[0m12:23:06.306944 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_airflow_public, now model.simple_dbt_project.my_first_model)
[0m12:23:06.307399 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly list_airflow, now model.simple_dbt_project.stg_orders)
[0m12:23:06.307771 [debug] [Thread-1  ]: Began compiling node model.simple_dbt_project.my_first_model
[0m12:23:06.308086 [debug] [Thread-2  ]: Began compiling node model.simple_dbt_project.stg_orders
[0m12:23:06.312683 [debug] [Thread-1  ]: Writing injected SQL for node "model.simple_dbt_project.my_first_model"
[0m12:23:06.314683 [debug] [Thread-2  ]: Writing injected SQL for node "model.simple_dbt_project.stg_orders"
[0m12:23:06.316640 [debug] [Thread-2  ]: Timing info for model.simple_dbt_project.stg_orders (compile): 12:23:06.312937 => 12:23:06.316467
[0m12:23:06.317018 [debug] [Thread-2  ]: Began executing node model.simple_dbt_project.stg_orders
[0m12:23:06.317355 [debug] [Thread-1  ]: Timing info for model.simple_dbt_project.my_first_model (compile): 12:23:06.308316 => 12:23:06.317213
[0m12:23:06.334722 [debug] [Thread-1  ]: Began executing node model.simple_dbt_project.my_first_model
[0m12:23:06.339485 [debug] [Thread-2  ]: Writing runtime sql for node "model.simple_dbt_project.stg_orders"
[0m12:23:06.343270 [debug] [Thread-1  ]: Writing runtime sql for node "model.simple_dbt_project.my_first_model"
[0m12:23:06.344671 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:23:06.345003 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: BEGIN
[0m12:23:06.345297 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m12:23:06.345578 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:23:06.346050 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: BEGIN
[0m12:23:06.346639 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:23:06.348310 [debug] [Thread-2  ]: SQL status: BEGIN in 0.0 seconds
[0m12:23:06.348685 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:23:06.349032 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.stg_orders"} */

  create view "airflow"."public"."stg_orders__dbt_tmp"
    
    
  as (
    

-- Staging model to clean and standardize raw orders data
SELECT
    order_id,
    customer_id,
    CAST(order_date AS DATE) as order_date,
    status,
    amount,
    CURRENT_TIMESTAMP as loaded_at
FROM "airflow"."raw"."orders"  -- This would point to your raw orders table
  );
[0m12:23:06.349358 [debug] [Thread-1  ]: SQL status: BEGIN in 0.0 seconds
[0m12:23:06.349685 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:23:06.350077 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.my_first_model"} */

  create view "airflow"."public"."my_first_model__dbt_tmp"
    
    
  as (
    -- Simple example model
SELECT 1 as id, 'Example' as name
UNION ALL
SELECT 2 as id, 'Test' as name
  );
[0m12:23:06.352141 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.0 seconds
[0m12:23:06.352438 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.0 seconds
[0m12:23:06.357034 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:23:06.359601 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.my_first_model"} */
alter table "airflow"."public"."my_first_model" rename to "my_first_model__dbt_backup"
[0m12:23:06.359261 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:23:06.359990 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.stg_orders"} */
alter table "airflow"."public"."stg_orders" rename to "stg_orders__dbt_backup"
[0m12:23:06.360562 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:23:06.360822 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:23:06.362691 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:23:06.364860 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.my_first_model"} */
alter table "airflow"."public"."my_first_model__dbt_tmp" rename to "my_first_model"
[0m12:23:06.364534 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:23:06.365229 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.stg_orders"} */
alter table "airflow"."public"."stg_orders__dbt_tmp" rename to "stg_orders"
[0m12:23:06.365487 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:23:06.373838 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:23:06.376435 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: COMMIT
[0m12:23:06.376753 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:23:06.377021 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: COMMIT
[0m12:23:06.375533 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: COMMIT
[0m12:23:06.377395 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:23:06.377732 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: COMMIT
[0m12:23:06.379750 [debug] [Thread-2  ]: SQL status: COMMIT in 0.0 seconds
[0m12:23:06.380040 [debug] [Thread-1  ]: SQL status: COMMIT in 0.0 seconds
[0m12:23:06.383829 [debug] [Thread-2  ]: Applying DROP to: "airflow"."public"."stg_orders__dbt_backup"
[0m12:23:06.385506 [debug] [Thread-1  ]: Applying DROP to: "airflow"."public"."my_first_model__dbt_backup"
[0m12:23:06.388788 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:23:06.389078 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.my_first_model"} */
drop view if exists "airflow"."public"."my_first_model__dbt_backup" cascade
[0m12:23:06.388284 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:23:06.389456 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.stg_orders"} */
drop view if exists "airflow"."public"."stg_orders__dbt_backup" cascade
[0m12:23:06.390242 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.0 seconds
[0m12:23:06.391231 [debug] [Thread-1  ]: Timing info for model.simple_dbt_project.my_first_model (execute): 12:23:06.339730 => 12:23:06.391096
[0m12:23:06.391739 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: Close
[0m12:23:06.391488 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.0 seconds
[0m12:23:06.392411 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6593238f-9034-49d4-aca3-f6db781750ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9d1418b0>]}
[0m12:23:06.394063 [info ] [Thread-1  ]: 1 of 4 OK created sql view model public.my_first_model ......................... [[32mCREATE VIEW[0m in 0.09s]
[0m12:23:06.393587 [debug] [Thread-2  ]: Timing info for model.simple_dbt_project.stg_orders (execute): 12:23:06.317528 => 12:23:06.393416
[0m12:23:06.394996 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: Close
[0m12:23:06.394627 [debug] [Thread-1  ]: Finished running node model.simple_dbt_project.my_first_model
[0m12:23:06.395659 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6593238f-9034-49d4-aca3-f6db781750ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9da98520>]}
[0m12:23:06.396215 [info ] [Thread-2  ]: 2 of 4 OK created sql view model public.stg_orders ............................. [[32mCREATE VIEW[0m in 0.09s]
[0m12:23:06.396705 [debug] [Thread-2  ]: Finished running node model.simple_dbt_project.stg_orders
[0m12:23:06.397366 [debug] [Thread-4  ]: Began running node model.simple_dbt_project.fct_customer_purchase_patterns
[0m12:23:06.397696 [debug] [Thread-3  ]: Began running node model.simple_dbt_project.fct_daily_sales
[0m12:23:06.398035 [info ] [Thread-4  ]: 3 of 4 START sql table model public.fct_customer_purchase_patterns ............. [RUN]
[0m12:23:06.398460 [info ] [Thread-3  ]: 4 of 4 START sql table model public.fct_daily_sales ............................ [RUN]
[0m12:23:06.399051 [debug] [Thread-4  ]: Acquiring new postgres connection 'model.simple_dbt_project.fct_customer_purchase_patterns'
[0m12:23:06.399581 [debug] [Thread-3  ]: Acquiring new postgres connection 'model.simple_dbt_project.fct_daily_sales'
[0m12:23:06.399928 [debug] [Thread-4  ]: Began compiling node model.simple_dbt_project.fct_customer_purchase_patterns
[0m12:23:06.400240 [debug] [Thread-3  ]: Began compiling node model.simple_dbt_project.fct_daily_sales
[0m12:23:06.403326 [debug] [Thread-4  ]: Writing injected SQL for node "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:23:06.405365 [debug] [Thread-3  ]: Writing injected SQL for node "model.simple_dbt_project.fct_daily_sales"
[0m12:23:06.406701 [debug] [Thread-4  ]: Timing info for model.simple_dbt_project.fct_customer_purchase_patterns (compile): 12:23:06.400466 => 12:23:06.406550
[0m12:23:06.407069 [debug] [Thread-4  ]: Began executing node model.simple_dbt_project.fct_customer_purchase_patterns
[0m12:23:06.407397 [debug] [Thread-3  ]: Timing info for model.simple_dbt_project.fct_daily_sales (compile): 12:23:06.403625 => 12:23:06.407259
[0m12:23:06.422915 [debug] [Thread-3  ]: Began executing node model.simple_dbt_project.fct_daily_sales
[0m12:23:06.422574 [debug] [Thread-4  ]: Writing runtime sql for node "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:23:06.426039 [debug] [Thread-3  ]: Writing runtime sql for node "model.simple_dbt_project.fct_daily_sales"
[0m12:23:06.427167 [debug] [Thread-4  ]: Using postgres connection "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:23:06.427496 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: BEGIN
[0m12:23:06.427780 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:23:06.428273 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: BEGIN
[0m12:23:06.428504 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m12:23:06.427999 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m12:23:06.430968 [debug] [Thread-3  ]: SQL status: BEGIN in 0.0 seconds
[0m12:23:06.431687 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:23:06.432006 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_daily_sales"} */

  
    

  create  table "airflow"."public"."fct_daily_sales__dbt_tmp"
  
  
    as
  
  (
    

WITH daily_sales AS (
    SELECT
        DATE_TRUNC('day', order_date) as date,
        COUNT(DISTINCT order_id) as total_orders,
        COUNT(DISTINCT customer_id) as unique_customers,
        SUM(amount) as total_amount
    FROM "airflow"."public"."stg_orders"
    WHERE status = 'completed'
    GROUP BY 1
)

SELECT
    date,
    total_orders,
    unique_customers,
    total_amount,
    total_amount / NULLIF(total_orders, 0) as avg_order_value,
    total_amount / NULLIF(unique_customers, 0) as avg_customer_spend
FROM daily_sales
  );
  
[0m12:23:06.431297 [debug] [Thread-4  ]: SQL status: BEGIN in 0.0 seconds
[0m12:23:06.432381 [debug] [Thread-4  ]: Using postgres connection "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:23:06.432762 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_customer_purchase_patterns"} */

  
    

  create  table "airflow"."public"."fct_customer_purchase_patterns__dbt_tmp"
  
  
    as
  
  (
    

WITH customer_purchases AS (
    SELECT
        customer_id,
        order_date,
        amount,
        -- Common interview question: calculate days between purchases
        LAG(order_date) OVER (
            PARTITION BY customer_id 
            ORDER BY order_date
        ) as previous_order_date,
        -- Calculate running total
        SUM(amount) OVER (
            PARTITION BY customer_id 
            ORDER BY order_date
            ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
        ) as lifetime_spend
    FROM "airflow"."public"."stg_orders"
    WHERE status = 'completed'
),

purchase_metrics AS (
    SELECT
        customer_id,
        order_date,
        amount,
        previous_order_date,
        lifetime_spend,
        -- Common interview question: handle NULL for first purchase
        COALESCE(
            DATE_DIFF('day', previous_order_date, order_date),
            0
        ) as days_since_previous_order
    FROM customer_purchases
)

SELECT
    customer_id,
    COUNT(*) as total_orders,
    AVG(amount) as avg_order_value,
    AVG(days_since_previous_order) as avg_days_between_orders,
    MAX(lifetime_spend) as total_lifetime_spend,
    -- Common interview question: categorize customers
    CASE 
        WHEN MAX(lifetime_spend) > 1000 THEN 'high_value'
        WHEN MAX(lifetime_spend) > 500 THEN 'medium_value'
        ELSE 'low_value'
    END as customer_segment
FROM purchase_metrics
GROUP BY 1
  );
  
[0m12:23:06.433860 [debug] [Thread-4  ]: Postgres adapter: Postgres error: function date_diff(unknown, date, date) does not exist
LINE 43:             DATE_DIFF('day', previous_order_date, order_date...
                     ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.

[0m12:23:06.434235 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: ROLLBACK
[0m12:23:06.434859 [debug] [Thread-4  ]: Timing info for model.simple_dbt_project.fct_customer_purchase_patterns (execute): 12:23:06.407568 => 12:23:06.434655
[0m12:23:06.435226 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: Close
[0m12:23:06.437317 [debug] [Thread-4  ]: Database Error in model fct_customer_purchase_patterns (models/marts/fct_customer_purchase_patterns.sql)
  function date_diff(unknown, date, date) does not exist
  LINE 43:             DATE_DIFF('day', previous_order_date, order_date...
                       ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled Code at target/run/simple_dbt_project/models/marts/fct_customer_purchase_patterns.sql
[0m12:23:06.437924 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6593238f-9034-49d4-aca3-f6db781750ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9dabc070>]}
[0m12:23:06.438410 [debug] [Thread-3  ]: SQL status: SELECT 2 in 0.0 seconds
[0m12:23:06.438854 [error] [Thread-4  ]: 3 of 4 ERROR creating sql table model public.fct_customer_purchase_patterns .... [[31mERROR[0m in 0.04s]
[0m12:23:06.441810 [debug] [Thread-4  ]: Finished running node model.simple_dbt_project.fct_customer_purchase_patterns
[0m12:23:06.441336 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:23:06.442212 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_daily_sales"} */
alter table "airflow"."public"."fct_daily_sales" rename to "fct_daily_sales__dbt_backup"
[0m12:23:06.442700 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:23:06.444592 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:23:06.444884 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_daily_sales"} */
alter table "airflow"."public"."fct_daily_sales__dbt_tmp" rename to "fct_daily_sales"
[0m12:23:06.445268 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:23:06.448445 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: COMMIT
[0m12:23:06.448750 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:23:06.449006 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: COMMIT
[0m12:23:06.450487 [debug] [Thread-3  ]: SQL status: COMMIT in 0.0 seconds
[0m12:23:06.452137 [debug] [Thread-3  ]: Applying DROP to: "airflow"."public"."fct_daily_sales__dbt_backup"
[0m12:23:06.453764 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:23:06.454057 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_daily_sales"} */
drop table if exists "airflow"."public"."fct_daily_sales__dbt_backup" cascade
[0m12:23:06.455935 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.0 seconds
[0m12:23:06.456904 [debug] [Thread-3  ]: Timing info for model.simple_dbt_project.fct_daily_sales (execute): 12:23:06.423157 => 12:23:06.456772
[0m12:23:06.457188 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: Close
[0m12:23:06.457787 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6593238f-9034-49d4-aca3-f6db781750ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9d150730>]}
[0m12:23:06.458278 [info ] [Thread-3  ]: 4 of 4 OK created sql table model public.fct_daily_sales ....................... [[32mSELECT 2[0m in 0.06s]
[0m12:23:06.458707 [debug] [Thread-3  ]: Finished running node model.simple_dbt_project.fct_daily_sales
[0m12:23:06.459805 [debug] [MainThread]: Using postgres connection "master"
[0m12:23:06.460081 [debug] [MainThread]: On master: BEGIN
[0m12:23:06.460353 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:23:06.462584 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:23:06.462937 [debug] [MainThread]: On master: COMMIT
[0m12:23:06.463216 [debug] [MainThread]: Using postgres connection "master"
[0m12:23:06.463455 [debug] [MainThread]: On master: COMMIT
[0m12:23:06.463744 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m12:23:06.463980 [debug] [MainThread]: On master: Close
[0m12:23:06.464431 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:23:06.464684 [debug] [MainThread]: Connection 'model.simple_dbt_project.stg_orders' was properly closed.
[0m12:23:06.464906 [debug] [MainThread]: Connection 'model.simple_dbt_project.my_first_model' was properly closed.
[0m12:23:06.465119 [debug] [MainThread]: Connection 'model.simple_dbt_project.fct_customer_purchase_patterns' was properly closed.
[0m12:23:06.465327 [debug] [MainThread]: Connection 'model.simple_dbt_project.fct_daily_sales' was properly closed.
[0m12:23:06.465616 [info ] [MainThread]: 
[0m12:23:06.465876 [info ] [MainThread]: Finished running 2 view models, 2 table models in 0 hours 0 minutes and 0.22 seconds (0.22s).
[0m12:23:06.466555 [debug] [MainThread]: Command end result
[0m12:23:06.474349 [info ] [MainThread]: 
[0m12:23:06.474712 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m12:23:06.474964 [info ] [MainThread]: 
[0m12:23:06.475209 [error] [MainThread]:   Database Error in model fct_customer_purchase_patterns (models/marts/fct_customer_purchase_patterns.sql)
  function date_diff(unknown, date, date) does not exist
  LINE 43:             DATE_DIFF('day', previous_order_date, order_date...
                       ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled Code at target/run/simple_dbt_project/models/marts/fct_customer_purchase_patterns.sql
[0m12:23:06.475492 [info ] [MainThread]: 
[0m12:23:06.475850 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m12:23:06.476501 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.50129676, "process_user_time": 2.118186, "process_kernel_time": 0.22394, "process_mem_max_rss": "190240", "process_out_blocks": "1661", "command_success": false, "process_in_blocks": "0"}
[0m12:23:06.476919 [debug] [MainThread]: Command `dbt run` failed at 12:23:06.476823 after 0.50 seconds
[0m12:23:06.477237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa13cebb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9de199d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9db0c040>]}
[0m12:23:06.477549 [debug] [MainThread]: Flushing usage events
[0m12:24:23.984021 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb0357bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffad981d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffad981610>]}


============================== 12:24:23.988542 | ad234c9f-b1cc-4d47-94f7-3688ab0f9703 ==============================
[0m12:24:23.988542 [info ] [MainThread]: Running with dbt=1.7.3
[0m12:24:23.988987 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '.', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir .', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m12:24:24.132552 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ad234c9f-b1cc-4d47-94f7-3688ab0f9703', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaf1c9100>]}
[0m12:24:24.182468 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ad234c9f-b1cc-4d47-94f7-3688ab0f9703', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffacd769d0>]}
[0m12:24:24.183118 [info ] [MainThread]: Registered adapter: postgres=1.7.3
[0m12:24:24.189285 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m12:24:24.211099 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:24:24.211525 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:24:24.216285 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ad234c9f-b1cc-4d47-94f7-3688ab0f9703', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffacae6ee0>]}
[0m12:24:24.226688 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ad234c9f-b1cc-4d47-94f7-3688ab0f9703', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffacbb4cd0>]}
[0m12:24:24.227086 [info ] [MainThread]: Found 4 models, 5 tests, 1 source, 0 exposures, 0 metrics, 402 macros, 0 groups, 0 semantic models
[0m12:24:24.227557 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ad234c9f-b1cc-4d47-94f7-3688ab0f9703', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffacbb4e50>]}
[0m12:24:24.228598 [info ] [MainThread]: 
[0m12:24:24.229220 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:24:24.230184 [debug] [ThreadPool]: Acquiring new postgres connection 'list_airflow'
[0m12:24:24.238218 [debug] [ThreadPool]: Using postgres connection "list_airflow"
[0m12:24:24.238656 [debug] [ThreadPool]: On list_airflow: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_airflow"} */

    select distinct nspname from pg_namespace
  
[0m12:24:24.238915 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:24:24.242150 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.0 seconds
[0m12:24:24.243127 [debug] [ThreadPool]: On list_airflow: Close
[0m12:24:24.244536 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_airflow, now list_airflow_public)
[0m12:24:24.248651 [debug] [ThreadPool]: Using postgres connection "list_airflow_public"
[0m12:24:24.248962 [debug] [ThreadPool]: On list_airflow_public: BEGIN
[0m12:24:24.249202 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:24:24.251342 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m12:24:24.251690 [debug] [ThreadPool]: Using postgres connection "list_airflow_public"
[0m12:24:24.252006 [debug] [ThreadPool]: On list_airflow_public: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_airflow_public"} */
select
      'airflow' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'airflow' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'airflow' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m12:24:24.253828 [debug] [ThreadPool]: SQL status: SELECT 45 in 0.0 seconds
[0m12:24:24.255197 [debug] [ThreadPool]: On list_airflow_public: ROLLBACK
[0m12:24:24.255548 [debug] [ThreadPool]: On list_airflow_public: Close
[0m12:24:24.263378 [debug] [MainThread]: Using postgres connection "master"
[0m12:24:24.263808 [debug] [MainThread]: On master: BEGIN
[0m12:24:24.264057 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:24:24.266497 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:24:24.266833 [debug] [MainThread]: Using postgres connection "master"
[0m12:24:24.267137 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:24:24.271250 [debug] [MainThread]: SQL status: SELECT 1 in 0.0 seconds
[0m12:24:24.272207 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ad234c9f-b1cc-4d47-94f7-3688ab0f9703', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaccd6f10>]}
[0m12:24:24.272596 [debug] [MainThread]: On master: ROLLBACK
[0m12:24:24.272969 [debug] [MainThread]: Using postgres connection "master"
[0m12:24:24.273214 [debug] [MainThread]: On master: BEGIN
[0m12:24:24.273612 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:24:24.273905 [debug] [MainThread]: On master: COMMIT
[0m12:24:24.274155 [debug] [MainThread]: Using postgres connection "master"
[0m12:24:24.274385 [debug] [MainThread]: On master: COMMIT
[0m12:24:24.274693 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m12:24:24.274944 [debug] [MainThread]: On master: Close
[0m12:24:24.275428 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:24:24.275722 [info ] [MainThread]: 
[0m12:24:24.282184 [debug] [Thread-1  ]: Began running node model.simple_dbt_project.my_first_model
[0m12:24:24.282588 [debug] [Thread-2  ]: Began running node model.simple_dbt_project.stg_orders
[0m12:24:24.282956 [info ] [Thread-1  ]: 1 of 4 START sql view model public.my_first_model .............................. [RUN]
[0m12:24:24.283409 [info ] [Thread-2  ]: 2 of 4 START sql view model public.stg_orders .................................. [RUN]
[0m12:24:24.284140 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_airflow_public, now model.simple_dbt_project.my_first_model)
[0m12:24:24.284652 [debug] [Thread-2  ]: Acquiring new postgres connection 'model.simple_dbt_project.stg_orders'
[0m12:24:24.285013 [debug] [Thread-1  ]: Began compiling node model.simple_dbt_project.my_first_model
[0m12:24:24.285323 [debug] [Thread-2  ]: Began compiling node model.simple_dbt_project.stg_orders
[0m12:24:24.290391 [debug] [Thread-1  ]: Writing injected SQL for node "model.simple_dbt_project.my_first_model"
[0m12:24:24.293280 [debug] [Thread-2  ]: Writing injected SQL for node "model.simple_dbt_project.stg_orders"
[0m12:24:24.294995 [debug] [Thread-2  ]: Timing info for model.simple_dbt_project.stg_orders (compile): 12:24:24.290780 => 12:24:24.294813
[0m12:24:24.295313 [debug] [Thread-1  ]: Timing info for model.simple_dbt_project.my_first_model (compile): 12:24:24.285555 => 12:24:24.295179
[0m12:24:24.295583 [debug] [Thread-2  ]: Began executing node model.simple_dbt_project.stg_orders
[0m12:24:24.295902 [debug] [Thread-1  ]: Began executing node model.simple_dbt_project.my_first_model
[0m12:24:24.323909 [debug] [Thread-2  ]: Writing runtime sql for node "model.simple_dbt_project.stg_orders"
[0m12:24:24.324835 [debug] [Thread-1  ]: Writing runtime sql for node "model.simple_dbt_project.my_first_model"
[0m12:24:24.326433 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:24:24.326797 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: BEGIN
[0m12:24:24.327076 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:24:24.327574 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: BEGIN
[0m12:24:24.327835 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:24:24.327312 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m12:24:24.330741 [debug] [Thread-2  ]: SQL status: BEGIN in 0.0 seconds
[0m12:24:24.331329 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:24:24.331637 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.stg_orders"} */

  create view "airflow"."public"."stg_orders__dbt_tmp"
    
    
  as (
    

-- Staging model to clean and standardize raw orders data
SELECT
    order_id,
    customer_id,
    CAST(order_date AS DATE) as order_date,
    status,
    amount,
    CURRENT_TIMESTAMP as loaded_at
FROM "airflow"."raw"."orders"  -- This would point to your raw orders table
  );
[0m12:24:24.331094 [debug] [Thread-1  ]: SQL status: BEGIN in 0.0 seconds
[0m12:24:24.332009 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:24:24.332404 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.my_first_model"} */

  create view "airflow"."public"."my_first_model__dbt_tmp"
    
    
  as (
    -- Simple example model
SELECT 1 as id, 'Example' as name
UNION ALL
SELECT 2 as id, 'Test' as name
  );
[0m12:24:24.334846 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.0 seconds
[0m12:24:24.335195 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.0 seconds
[0m12:24:24.340110 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:24:24.342812 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.my_first_model"} */
alter table "airflow"."public"."my_first_model" rename to "my_first_model__dbt_backup"
[0m12:24:24.342466 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:24:24.343232 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.stg_orders"} */
alter table "airflow"."public"."stg_orders" rename to "stg_orders__dbt_backup"
[0m12:24:24.343514 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:24:24.345551 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:24:24.346073 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.my_first_model"} */
alter table "airflow"."public"."my_first_model__dbt_tmp" rename to "my_first_model"
[0m12:24:24.345842 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:24:24.348093 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:24:24.348595 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.stg_orders"} */
alter table "airflow"."public"."stg_orders__dbt_tmp" rename to "stg_orders"
[0m12:24:24.348373 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:24:24.357977 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:24:24.358817 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: COMMIT
[0m12:24:24.360047 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:24:24.360306 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: COMMIT
[0m12:24:24.359730 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: COMMIT
[0m12:24:24.360668 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:24:24.360962 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: COMMIT
[0m12:24:24.362188 [debug] [Thread-1  ]: SQL status: COMMIT in 0.0 seconds
[0m12:24:24.362471 [debug] [Thread-2  ]: SQL status: COMMIT in 0.0 seconds
[0m12:24:24.366450 [debug] [Thread-1  ]: Applying DROP to: "airflow"."public"."my_first_model__dbt_backup"
[0m12:24:24.370874 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:24:24.371178 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.my_first_model"} */
drop view if exists "airflow"."public"."my_first_model__dbt_backup" cascade
[0m12:24:24.368166 [debug] [Thread-2  ]: Applying DROP to: "airflow"."public"."stg_orders__dbt_backup"
[0m12:24:24.371704 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:24:24.372046 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.stg_orders"} */
drop view if exists "airflow"."public"."stg_orders__dbt_backup" cascade
[0m12:24:24.372308 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.0 seconds
[0m12:24:24.373331 [debug] [Thread-1  ]: Timing info for model.simple_dbt_project.my_first_model (execute): 12:24:24.312096 => 12:24:24.373189
[0m12:24:24.373833 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: Close
[0m12:24:24.374386 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad234c9f-b1cc-4d47-94f7-3688ab0f9703', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaca4cbb0>]}
[0m12:24:24.374908 [info ] [Thread-1  ]: 1 of 4 OK created sql view model public.my_first_model ......................... [[32mCREATE VIEW[0m in 0.09s]
[0m12:24:24.375386 [debug] [Thread-1  ]: Finished running node model.simple_dbt_project.my_first_model
[0m12:24:24.373592 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.0 seconds
[0m12:24:24.376567 [debug] [Thread-2  ]: Timing info for model.simple_dbt_project.stg_orders (execute): 12:24:24.296118 => 12:24:24.376439
[0m12:24:24.376883 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: Close
[0m12:24:24.377469 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad234c9f-b1cc-4d47-94f7-3688ab0f9703', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffacab7a00>]}
[0m12:24:24.377977 [info ] [Thread-2  ]: 2 of 4 OK created sql view model public.stg_orders ............................. [[32mCREATE VIEW[0m in 0.09s]
[0m12:24:24.378436 [debug] [Thread-2  ]: Finished running node model.simple_dbt_project.stg_orders
[0m12:24:24.379139 [debug] [Thread-4  ]: Began running node model.simple_dbt_project.fct_customer_purchase_patterns
[0m12:24:24.379466 [debug] [Thread-3  ]: Began running node model.simple_dbt_project.fct_daily_sales
[0m12:24:24.379828 [info ] [Thread-4  ]: 3 of 4 START sql table model public.fct_customer_purchase_patterns ............. [RUN]
[0m12:24:24.380258 [info ] [Thread-3  ]: 4 of 4 START sql table model public.fct_daily_sales ............................ [RUN]
[0m12:24:24.380904 [debug] [Thread-4  ]: Acquiring new postgres connection 'model.simple_dbt_project.fct_customer_purchase_patterns'
[0m12:24:24.381430 [debug] [Thread-3  ]: Acquiring new postgres connection 'model.simple_dbt_project.fct_daily_sales'
[0m12:24:24.381774 [debug] [Thread-4  ]: Began compiling node model.simple_dbt_project.fct_customer_purchase_patterns
[0m12:24:24.382093 [debug] [Thread-3  ]: Began compiling node model.simple_dbt_project.fct_daily_sales
[0m12:24:24.385271 [debug] [Thread-4  ]: Writing injected SQL for node "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:24:24.387319 [debug] [Thread-3  ]: Writing injected SQL for node "model.simple_dbt_project.fct_daily_sales"
[0m12:24:24.388388 [debug] [Thread-4  ]: Timing info for model.simple_dbt_project.fct_customer_purchase_patterns (compile): 12:24:24.382313 => 12:24:24.388227
[0m12:24:24.388777 [debug] [Thread-4  ]: Began executing node model.simple_dbt_project.fct_customer_purchase_patterns
[0m12:24:24.389178 [debug] [Thread-3  ]: Timing info for model.simple_dbt_project.fct_daily_sales (compile): 12:24:24.385539 => 12:24:24.388949
[0m12:24:24.406200 [debug] [Thread-3  ]: Began executing node model.simple_dbt_project.fct_daily_sales
[0m12:24:24.406703 [debug] [Thread-4  ]: Writing runtime sql for node "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:24:24.410163 [debug] [Thread-3  ]: Writing runtime sql for node "model.simple_dbt_project.fct_daily_sales"
[0m12:24:24.411297 [debug] [Thread-4  ]: Using postgres connection "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:24:24.411682 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: BEGIN
[0m12:24:24.412018 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:24:24.412544 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: BEGIN
[0m12:24:24.412796 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m12:24:24.412279 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m12:24:24.416855 [debug] [Thread-3  ]: SQL status: BEGIN in 0.0 seconds
[0m12:24:24.417254 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:24:24.417619 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_daily_sales"} */

  
    

  create  table "airflow"."public"."fct_daily_sales__dbt_tmp"
  
  
    as
  
  (
    

WITH daily_sales AS (
    SELECT
        DATE_TRUNC('day', order_date) as date,
        COUNT(DISTINCT order_id) as total_orders,
        COUNT(DISTINCT customer_id) as unique_customers,
        SUM(amount) as total_amount
    FROM "airflow"."public"."stg_orders"
    WHERE status = 'completed'
    GROUP BY 1
)

SELECT
    date,
    total_orders,
    unique_customers,
    total_amount,
    total_amount / NULLIF(total_orders, 0) as avg_order_value,
    total_amount / NULLIF(unique_customers, 0) as avg_customer_spend
FROM daily_sales
  );
  
[0m12:24:24.418168 [debug] [Thread-4  ]: SQL status: BEGIN in 0.0 seconds
[0m12:24:24.418496 [debug] [Thread-4  ]: Using postgres connection "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:24:24.418955 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_customer_purchase_patterns"} */

  
    

  create  table "airflow"."public"."fct_customer_purchase_patterns__dbt_tmp"
  
  
    as
  
  (
    

WITH customer_purchases AS (
    SELECT
        customer_id,
        order_date,
        amount,
        -- Common interview question: calculate days between purchases
        LAG(order_date) OVER (
            PARTITION BY customer_id 
            ORDER BY order_date
        ) as previous_order_date,
        -- Calculate running total
        SUM(amount) OVER (
            PARTITION BY customer_id 
            ORDER BY order_date
            ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
        ) as lifetime_spend
    FROM "airflow"."public"."stg_orders"
    WHERE status = 'completed'
),

purchase_metrics AS (
    SELECT
        customer_id,
        order_date,
        amount,
        previous_order_date,
        lifetime_spend,
        -- Common interview question: handle NULL for first purchase
        COALESCE(
            DATE_DIFF('day', previous_order_date, order_date),
            0
        ) as days_since_previous_order
    FROM customer_purchases
)

SELECT
    customer_id,
    COUNT(*) as total_orders,
    AVG(amount) as avg_order_value,
    AVG(days_since_previous_order) as avg_days_between_orders,
    MAX(lifetime_spend) as total_lifetime_spend,
    -- Common interview question: categorize customers
    CASE 
        WHEN MAX(lifetime_spend) > 1000 THEN 'high_value'
        WHEN MAX(lifetime_spend) > 500 THEN 'medium_value'
        ELSE 'low_value'
    END as customer_segment
FROM purchase_metrics
GROUP BY 1
  );
  
[0m12:24:24.420263 [debug] [Thread-4  ]: Postgres adapter: Postgres error: function date_diff(unknown, date, date) does not exist
LINE 43:             DATE_DIFF('day', previous_order_date, order_date...
                     ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.

[0m12:24:24.420716 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: ROLLBACK
[0m12:24:24.421476 [debug] [Thread-4  ]: Timing info for model.simple_dbt_project.fct_customer_purchase_patterns (execute): 12:24:24.389383 => 12:24:24.421268
[0m12:24:24.421918 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: Close
[0m12:24:24.424336 [debug] [Thread-4  ]: Database Error in model fct_customer_purchase_patterns (models/marts/fct_customer_purchase_patterns.sql)
  function date_diff(unknown, date, date) does not exist
  LINE 43:             DATE_DIFF('day', previous_order_date, order_date...
                       ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled Code at target/run/simple_dbt_project/models/marts/fct_customer_purchase_patterns.sql
[0m12:24:24.424711 [debug] [Thread-3  ]: SQL status: SELECT 2 in 0.0 seconds
[0m12:24:24.425074 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad234c9f-b1cc-4d47-94f7-3688ab0f9703', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaca1a400>]}
[0m12:24:24.428258 [error] [Thread-4  ]: 3 of 4 ERROR creating sql table model public.fct_customer_purchase_patterns .... [[31mERROR[0m in 0.04s]
[0m12:24:24.428808 [debug] [Thread-4  ]: Finished running node model.simple_dbt_project.fct_customer_purchase_patterns
[0m12:24:24.427667 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:24:24.429379 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_daily_sales"} */
alter table "airflow"."public"."fct_daily_sales" rename to "fct_daily_sales__dbt_backup"
[0m12:24:24.429941 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:24:24.432290 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:24:24.432678 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_daily_sales"} */
alter table "airflow"."public"."fct_daily_sales__dbt_tmp" rename to "fct_daily_sales"
[0m12:24:24.433336 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:24:24.436828 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: COMMIT
[0m12:24:24.437263 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:24:24.437586 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: COMMIT
[0m12:24:24.438816 [debug] [Thread-3  ]: SQL status: COMMIT in 0.0 seconds
[0m12:24:24.440926 [debug] [Thread-3  ]: Applying DROP to: "airflow"."public"."fct_daily_sales__dbt_backup"
[0m12:24:24.443216 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:24:24.443740 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_daily_sales"} */
drop table if exists "airflow"."public"."fct_daily_sales__dbt_backup" cascade
[0m12:24:24.445123 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.0 seconds
[0m12:24:24.446474 [debug] [Thread-3  ]: Timing info for model.simple_dbt_project.fct_daily_sales (execute): 12:24:24.406915 => 12:24:24.446323
[0m12:24:24.446840 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: Close
[0m12:24:24.447476 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad234c9f-b1cc-4d47-94f7-3688ab0f9703', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffac1b3760>]}
[0m12:24:24.448004 [info ] [Thread-3  ]: 4 of 4 OK created sql table model public.fct_daily_sales ....................... [[32mSELECT 2[0m in 0.07s]
[0m12:24:24.448485 [debug] [Thread-3  ]: Finished running node model.simple_dbt_project.fct_daily_sales
[0m12:24:24.449868 [debug] [MainThread]: Using postgres connection "master"
[0m12:24:24.450194 [debug] [MainThread]: On master: BEGIN
[0m12:24:24.450431 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:24:24.452555 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:24:24.452929 [debug] [MainThread]: On master: COMMIT
[0m12:24:24.453195 [debug] [MainThread]: Using postgres connection "master"
[0m12:24:24.453429 [debug] [MainThread]: On master: COMMIT
[0m12:24:24.453810 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m12:24:24.454263 [debug] [MainThread]: On master: Close
[0m12:24:24.454857 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:24:24.455240 [debug] [MainThread]: Connection 'model.simple_dbt_project.my_first_model' was properly closed.
[0m12:24:24.455519 [debug] [MainThread]: Connection 'model.simple_dbt_project.stg_orders' was properly closed.
[0m12:24:24.455802 [debug] [MainThread]: Connection 'model.simple_dbt_project.fct_customer_purchase_patterns' was properly closed.
[0m12:24:24.456065 [debug] [MainThread]: Connection 'model.simple_dbt_project.fct_daily_sales' was properly closed.
[0m12:24:24.456388 [info ] [MainThread]: 
[0m12:24:24.456680 [info ] [MainThread]: Finished running 2 view models, 2 table models in 0 hours 0 minutes and 0.23 seconds (0.23s).
[0m12:24:24.457449 [debug] [MainThread]: Command end result
[0m12:24:24.464813 [info ] [MainThread]: 
[0m12:24:24.465163 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m12:24:24.465447 [info ] [MainThread]: 
[0m12:24:24.465835 [error] [MainThread]:   Database Error in model fct_customer_purchase_patterns (models/marts/fct_customer_purchase_patterns.sql)
  function date_diff(unknown, date, date) does not exist
  LINE 43:             DATE_DIFF('day', previous_order_date, order_date...
                       ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled Code at target/run/simple_dbt_project/models/marts/fct_customer_purchase_patterns.sql
[0m12:24:24.466164 [info ] [MainThread]: 
[0m12:24:24.466970 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m12:24:24.467655 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.5097066, "process_user_time": 1.986036, "process_kernel_time": 0.147779, "process_mem_max_rss": "182180", "process_out_blocks": "1662", "command_success": false, "process_in_blocks": "0"}
[0m12:24:24.468068 [debug] [MainThread]: Command `dbt run` failed at 12:24:24.467972 after 0.51 seconds
[0m12:24:24.468371 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb0357bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffacd769d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaca69ee0>]}
[0m12:24:24.468667 [debug] [MainThread]: Flushing usage events
[0m12:27:12.736964 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8bde9f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89404d00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89404ca0>]}


============================== 12:27:12.742217 | 1412baf0-52fb-4fbb-8c6c-29f06aeb4724 ==============================
[0m12:27:12.742217 [info ] [MainThread]: Running with dbt=1.7.3
[0m12:27:12.744766 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '.', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --profiles-dir .', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m12:27:12.917589 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1412baf0-52fb-4fbb-8c6c-29f06aeb4724', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89404670>]}
[0m12:27:12.971985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1412baf0-52fb-4fbb-8c6c-29f06aeb4724', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8e477940>]}
[0m12:27:12.972667 [info ] [MainThread]: Registered adapter: postgres=1.7.3
[0m12:27:12.979214 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m12:27:13.007143 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:27:13.007576 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:27:13.011970 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1412baf0-52fb-4fbb-8c6c-29f06aeb4724', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88557eb0>]}
[0m12:27:13.023279 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1412baf0-52fb-4fbb-8c6c-29f06aeb4724', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88629ca0>]}
[0m12:27:13.023715 [info ] [MainThread]: Found 4 models, 5 tests, 1 source, 0 exposures, 0 metrics, 402 macros, 0 groups, 0 semantic models
[0m12:27:13.024299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1412baf0-52fb-4fbb-8c6c-29f06aeb4724', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88629e20>]}
[0m12:27:13.025543 [info ] [MainThread]: 
[0m12:27:13.026457 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:27:13.027550 [debug] [ThreadPool]: Acquiring new postgres connection 'list_airflow'
[0m12:27:13.035628 [debug] [ThreadPool]: Using postgres connection "list_airflow"
[0m12:27:13.036281 [debug] [ThreadPool]: On list_airflow: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_airflow"} */

    select distinct nspname from pg_namespace
  
[0m12:27:13.036588 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:27:13.046333 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.0 seconds
[0m12:27:13.047415 [debug] [ThreadPool]: On list_airflow: Close
[0m12:27:13.049165 [debug] [ThreadPool]: Acquiring new postgres connection 'list_airflow_public'
[0m12:27:13.054609 [debug] [ThreadPool]: Using postgres connection "list_airflow_public"
[0m12:27:13.055210 [debug] [ThreadPool]: On list_airflow_public: BEGIN
[0m12:27:13.055520 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:27:13.058855 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m12:27:13.059384 [debug] [ThreadPool]: Using postgres connection "list_airflow_public"
[0m12:27:13.059675 [debug] [ThreadPool]: On list_airflow_public: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_airflow_public"} */
select
      'airflow' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'airflow' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'airflow' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m12:27:13.062368 [debug] [ThreadPool]: SQL status: SELECT 45 in 0.0 seconds
[0m12:27:13.064343 [debug] [ThreadPool]: On list_airflow_public: ROLLBACK
[0m12:27:13.064887 [debug] [ThreadPool]: On list_airflow_public: Close
[0m12:27:13.073004 [debug] [MainThread]: Using postgres connection "master"
[0m12:27:13.073518 [debug] [MainThread]: On master: BEGIN
[0m12:27:13.073825 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:27:13.077223 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:27:13.077616 [debug] [MainThread]: Using postgres connection "master"
[0m12:27:13.077971 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:27:13.084097 [debug] [MainThread]: SQL status: SELECT 1 in 0.0 seconds
[0m12:27:13.085084 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1412baf0-52fb-4fbb-8c6c-29f06aeb4724', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88747940>]}
[0m12:27:13.085469 [debug] [MainThread]: On master: ROLLBACK
[0m12:27:13.085840 [debug] [MainThread]: Using postgres connection "master"
[0m12:27:13.086094 [debug] [MainThread]: On master: BEGIN
[0m12:27:13.086560 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:27:13.086875 [debug] [MainThread]: On master: COMMIT
[0m12:27:13.087152 [debug] [MainThread]: Using postgres connection "master"
[0m12:27:13.087390 [debug] [MainThread]: On master: COMMIT
[0m12:27:13.087752 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m12:27:13.088040 [debug] [MainThread]: On master: Close
[0m12:27:13.088577 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:27:13.088991 [info ] [MainThread]: 
[0m12:27:13.095504 [debug] [Thread-1  ]: Began running node model.simple_dbt_project.my_first_model
[0m12:27:13.095887 [debug] [Thread-2  ]: Began running node model.simple_dbt_project.stg_orders
[0m12:27:13.096277 [info ] [Thread-1  ]: 1 of 4 START sql view model public.my_first_model .............................. [RUN]
[0m12:27:13.096657 [info ] [Thread-2  ]: 2 of 4 START sql view model public.stg_orders .................................. [RUN]
[0m12:27:13.097387 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_airflow_public, now model.simple_dbt_project.my_first_model)
[0m12:27:13.097914 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly list_airflow, now model.simple_dbt_project.stg_orders)
[0m12:27:13.098297 [debug] [Thread-1  ]: Began compiling node model.simple_dbt_project.my_first_model
[0m12:27:13.098616 [debug] [Thread-2  ]: Began compiling node model.simple_dbt_project.stg_orders
[0m12:27:13.103597 [debug] [Thread-1  ]: Writing injected SQL for node "model.simple_dbt_project.my_first_model"
[0m12:27:13.107045 [debug] [Thread-2  ]: Writing injected SQL for node "model.simple_dbt_project.stg_orders"
[0m12:27:13.108523 [debug] [Thread-2  ]: Timing info for model.simple_dbt_project.stg_orders (compile): 12:27:13.104156 => 12:27:13.108332
[0m12:27:13.108880 [debug] [Thread-1  ]: Timing info for model.simple_dbt_project.my_first_model (compile): 12:27:13.098869 => 12:27:13.108719
[0m12:27:13.109187 [debug] [Thread-2  ]: Began executing node model.simple_dbt_project.stg_orders
[0m12:27:13.109508 [debug] [Thread-1  ]: Began executing node model.simple_dbt_project.my_first_model
[0m12:27:13.138431 [debug] [Thread-2  ]: Writing runtime sql for node "model.simple_dbt_project.stg_orders"
[0m12:27:13.139529 [debug] [Thread-1  ]: Writing runtime sql for node "model.simple_dbt_project.my_first_model"
[0m12:27:13.140639 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:27:13.141056 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: BEGIN
[0m12:27:13.141373 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:27:13.141949 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: BEGIN
[0m12:27:13.142255 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:27:13.141611 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m12:27:13.144979 [debug] [Thread-1  ]: SQL status: BEGIN in 0.0 seconds
[0m12:27:13.145606 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:27:13.145907 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.my_first_model"} */

  create view "airflow"."public"."my_first_model__dbt_tmp"
    
    
  as (
    -- Simple example model
SELECT 1 as id, 'Example' as name
UNION ALL
SELECT 2 as id, 'Test' as name
  );
[0m12:27:13.145357 [debug] [Thread-2  ]: SQL status: BEGIN in 0.0 seconds
[0m12:27:13.146279 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:27:13.146727 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.stg_orders"} */

  create view "airflow"."public"."stg_orders__dbt_tmp"
    
    
  as (
    

-- Staging model to clean and standardize raw orders data
SELECT
    order_id,
    customer_id,
    CAST(order_date AS DATE) as order_date,
    status,
    amount,
    CURRENT_TIMESTAMP as loaded_at
FROM "airflow"."raw"."orders"  -- This would point to your raw orders table
  );
[0m12:27:13.149045 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.0 seconds
[0m12:27:13.149512 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.0 seconds
[0m12:27:13.155474 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:27:13.158761 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.my_first_model"} */
alter table "airflow"."public"."my_first_model" rename to "my_first_model__dbt_backup"
[0m12:27:13.158286 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:27:13.159170 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.stg_orders"} */
alter table "airflow"."public"."stg_orders" rename to "stg_orders__dbt_backup"
[0m12:27:13.159475 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:27:13.161665 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:27:13.162264 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.my_first_model"} */
alter table "airflow"."public"."my_first_model__dbt_tmp" rename to "my_first_model"
[0m12:27:13.161991 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:27:13.164660 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:27:13.165321 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.stg_orders"} */
alter table "airflow"."public"."stg_orders__dbt_tmp" rename to "stg_orders"
[0m12:27:13.165073 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:27:13.175821 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: COMMIT
[0m12:27:13.176442 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:27:13.176746 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: COMMIT
[0m12:27:13.176200 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:27:13.177965 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: COMMIT
[0m12:27:13.178472 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:27:13.178808 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: COMMIT
[0m12:27:13.178250 [debug] [Thread-1  ]: SQL status: COMMIT in 0.0 seconds
[0m12:27:13.183728 [debug] [Thread-1  ]: Applying DROP to: "airflow"."public"."my_first_model__dbt_backup"
[0m12:27:13.184120 [debug] [Thread-2  ]: SQL status: COMMIT in 0.0 seconds
[0m12:27:13.186773 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:27:13.189035 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.my_first_model"} */
drop view if exists "airflow"."public"."my_first_model__dbt_backup" cascade
[0m12:27:13.188627 [debug] [Thread-2  ]: Applying DROP to: "airflow"."public"."stg_orders__dbt_backup"
[0m12:27:13.189610 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:27:13.190006 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.stg_orders"} */
drop view if exists "airflow"."public"."stg_orders__dbt_backup" cascade
[0m12:27:13.190666 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.0 seconds
[0m12:27:13.191739 [debug] [Thread-1  ]: Timing info for model.simple_dbt_project.my_first_model (execute): 12:27:13.126727 => 12:27:13.191580
[0m12:27:13.192247 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: Close
[0m12:27:13.192822 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1412baf0-52fb-4fbb-8c6c-29f06aeb4724', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff884bfca0>]}
[0m12:27:13.193310 [info ] [Thread-1  ]: 1 of 4 OK created sql view model public.my_first_model ......................... [[32mCREATE VIEW[0m in 0.10s]
[0m12:27:13.193834 [debug] [Thread-1  ]: Finished running node model.simple_dbt_project.my_first_model
[0m12:27:13.192012 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.0 seconds
[0m12:27:13.195124 [debug] [Thread-2  ]: Timing info for model.simple_dbt_project.stg_orders (execute): 12:27:13.109744 => 12:27:13.194973
[0m12:27:13.195501 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: Close
[0m12:27:13.196155 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1412baf0-52fb-4fbb-8c6c-29f06aeb4724', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff884dce50>]}
[0m12:27:13.197517 [info ] [Thread-2  ]: 2 of 4 OK created sql view model public.stg_orders ............................. [[32mCREATE VIEW[0m in 0.10s]
[0m12:27:13.198239 [debug] [Thread-2  ]: Finished running node model.simple_dbt_project.stg_orders
[0m12:27:13.199402 [debug] [Thread-4  ]: Began running node model.simple_dbt_project.fct_customer_purchase_patterns
[0m12:27:13.199904 [debug] [Thread-3  ]: Began running node model.simple_dbt_project.fct_daily_sales
[0m12:27:13.200286 [info ] [Thread-4  ]: 3 of 4 START sql table model public.fct_customer_purchase_patterns ............. [RUN]
[0m12:27:13.200846 [info ] [Thread-3  ]: 4 of 4 START sql table model public.fct_daily_sales ............................ [RUN]
[0m12:27:13.201794 [debug] [Thread-4  ]: Acquiring new postgres connection 'model.simple_dbt_project.fct_customer_purchase_patterns'
[0m12:27:13.202648 [debug] [Thread-3  ]: Acquiring new postgres connection 'model.simple_dbt_project.fct_daily_sales'
[0m12:27:13.203059 [debug] [Thread-4  ]: Began compiling node model.simple_dbt_project.fct_customer_purchase_patterns
[0m12:27:13.203399 [debug] [Thread-3  ]: Began compiling node model.simple_dbt_project.fct_daily_sales
[0m12:27:13.206906 [debug] [Thread-4  ]: Writing injected SQL for node "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:27:13.209421 [debug] [Thread-3  ]: Writing injected SQL for node "model.simple_dbt_project.fct_daily_sales"
[0m12:27:13.210558 [debug] [Thread-4  ]: Timing info for model.simple_dbt_project.fct_customer_purchase_patterns (compile): 12:27:13.203623 => 12:27:13.210388
[0m12:27:13.210933 [debug] [Thread-4  ]: Began executing node model.simple_dbt_project.fct_customer_purchase_patterns
[0m12:27:13.211290 [debug] [Thread-3  ]: Timing info for model.simple_dbt_project.fct_daily_sales (compile): 12:27:13.207381 => 12:27:13.211124
[0m12:27:13.226934 [debug] [Thread-3  ]: Began executing node model.simple_dbt_project.fct_daily_sales
[0m12:27:13.228888 [debug] [Thread-4  ]: Writing runtime sql for node "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:27:13.233588 [debug] [Thread-3  ]: Writing runtime sql for node "model.simple_dbt_project.fct_daily_sales"
[0m12:27:13.235122 [debug] [Thread-4  ]: Using postgres connection "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:27:13.235543 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: BEGIN
[0m12:27:13.235875 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:27:13.236580 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: BEGIN
[0m12:27:13.236987 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m12:27:13.236114 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m12:27:13.241097 [debug] [Thread-3  ]: SQL status: BEGIN in 0.0 seconds
[0m12:27:13.241556 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:27:13.241875 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_daily_sales"} */

  
    

  create  table "airflow"."public"."fct_daily_sales__dbt_tmp"
  
  
    as
  
  (
    

WITH daily_sales AS (
    SELECT
        DATE_TRUNC('day', order_date) as date,
        COUNT(DISTINCT order_id) as total_orders,
        COUNT(DISTINCT customer_id) as unique_customers,
        SUM(amount) as total_amount
    FROM "airflow"."public"."stg_orders"
    WHERE status = 'completed'
    GROUP BY 1
)

SELECT
    date,
    total_orders,
    unique_customers,
    total_amount,
    total_amount / NULLIF(total_orders, 0) as avg_order_value,
    total_amount / NULLIF(unique_customers, 0) as avg_customer_spend
FROM daily_sales
  );
  
[0m12:27:13.242303 [debug] [Thread-4  ]: SQL status: BEGIN in 0.0 seconds
[0m12:27:13.242628 [debug] [Thread-4  ]: Using postgres connection "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:27:13.243038 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_customer_purchase_patterns"} */

  
    

  create  table "airflow"."public"."fct_customer_purchase_patterns__dbt_tmp"
  
  
    as
  
  (
    

WITH customer_purchases AS (
    SELECT
        customer_id,
        order_date,
        amount,
        -- Common interview question: calculate days between purchases
        LAG(order_date) OVER (
            PARTITION BY customer_id 
            ORDER BY order_date
        ) as previous_order_date,
        -- Calculate running total
        SUM(amount) OVER (
            PARTITION BY customer_id 
            ORDER BY order_date
            ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW
        ) as lifetime_spend
    FROM "airflow"."public"."stg_orders"
    WHERE status = 'completed'
),

purchase_metrics AS (
    SELECT
        customer_id,
        order_date,
        amount,
        previous_order_date,
        lifetime_spend,
        -- Common interview question: handle NULL for first purchase
        COALESCE(
            DATE_DIFF('day', previous_order_date, order_date),
            0
        ) as days_since_previous_order
    FROM customer_purchases
)

SELECT
    customer_id,
    COUNT(*) as total_orders,
    AVG(amount) as avg_order_value,
    AVG(days_since_previous_order) as avg_days_between_orders,
    MAX(lifetime_spend) as total_lifetime_spend,
    -- Common interview question: categorize customers
    CASE 
        WHEN MAX(lifetime_spend) > 1000 THEN 'high_value'
        WHEN MAX(lifetime_spend) > 500 THEN 'medium_value'
        ELSE 'low_value'
    END as customer_segment
FROM purchase_metrics
GROUP BY 1
  );
  
[0m12:27:13.244284 [debug] [Thread-4  ]: Postgres adapter: Postgres error: function date_diff(unknown, date, date) does not exist
LINE 43:             DATE_DIFF('day', previous_order_date, order_date...
                     ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.

[0m12:27:13.244736 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: ROLLBACK
[0m12:27:13.245342 [debug] [Thread-4  ]: Timing info for model.simple_dbt_project.fct_customer_purchase_patterns (execute): 12:27:13.211470 => 12:27:13.245129
[0m12:27:13.245911 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: Close
[0m12:27:13.247899 [debug] [Thread-3  ]: SQL status: SELECT 2 in 0.0 seconds
[0m12:27:13.249668 [debug] [Thread-4  ]: Database Error in model fct_customer_purchase_patterns (models/marts/fct_customer_purchase_patterns.sql)
  function date_diff(unknown, date, date) does not exist
  LINE 43:             DATE_DIFF('day', previous_order_date, order_date...
                       ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled Code at target/run/simple_dbt_project/models/marts/fct_customer_purchase_patterns.sql
[0m12:27:13.252857 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1412baf0-52fb-4fbb-8c6c-29f06aeb4724', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff884687c0>]}
[0m12:27:13.253340 [error] [Thread-4  ]: 3 of 4 ERROR creating sql table model public.fct_customer_purchase_patterns .... [[31mERROR[0m in 0.05s]
[0m12:27:13.253821 [debug] [Thread-4  ]: Finished running node model.simple_dbt_project.fct_customer_purchase_patterns
[0m12:27:13.252358 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:27:13.254352 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_daily_sales"} */
alter table "airflow"."public"."fct_daily_sales" rename to "fct_daily_sales__dbt_backup"
[0m12:27:13.254972 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:27:13.257369 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:27:13.258057 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_daily_sales"} */
alter table "airflow"."public"."fct_daily_sales__dbt_tmp" rename to "fct_daily_sales"
[0m12:27:13.258732 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:27:13.262586 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: COMMIT
[0m12:27:13.263052 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:27:13.263370 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: COMMIT
[0m12:27:13.264857 [debug] [Thread-3  ]: SQL status: COMMIT in 0.0 seconds
[0m12:27:13.267304 [debug] [Thread-3  ]: Applying DROP to: "airflow"."public"."fct_daily_sales__dbt_backup"
[0m12:27:13.269399 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:27:13.270087 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_daily_sales"} */
drop table if exists "airflow"."public"."fct_daily_sales__dbt_backup" cascade
[0m12:27:13.272641 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.0 seconds
[0m12:27:13.273877 [debug] [Thread-3  ]: Timing info for model.simple_dbt_project.fct_daily_sales (execute): 12:27:13.229126 => 12:27:13.273734
[0m12:27:13.274202 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: Close
[0m12:27:13.274904 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1412baf0-52fb-4fbb-8c6c-29f06aeb4724', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88629ee0>]}
[0m12:27:13.275394 [info ] [Thread-3  ]: 4 of 4 OK created sql table model public.fct_daily_sales ....................... [[32mSELECT 2[0m in 0.07s]
[0m12:27:13.275910 [debug] [Thread-3  ]: Finished running node model.simple_dbt_project.fct_daily_sales
[0m12:27:13.277593 [debug] [MainThread]: Using postgres connection "master"
[0m12:27:13.277928 [debug] [MainThread]: On master: BEGIN
[0m12:27:13.278183 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:27:13.281469 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:27:13.282101 [debug] [MainThread]: On master: COMMIT
[0m12:27:13.282718 [debug] [MainThread]: Using postgres connection "master"
[0m12:27:13.283039 [debug] [MainThread]: On master: COMMIT
[0m12:27:13.283419 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m12:27:13.283681 [debug] [MainThread]: On master: Close
[0m12:27:13.284207 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:27:13.284504 [debug] [MainThread]: Connection 'model.simple_dbt_project.stg_orders' was properly closed.
[0m12:27:13.284805 [debug] [MainThread]: Connection 'model.simple_dbt_project.my_first_model' was properly closed.
[0m12:27:13.285048 [debug] [MainThread]: Connection 'model.simple_dbt_project.fct_customer_purchase_patterns' was properly closed.
[0m12:27:13.285265 [debug] [MainThread]: Connection 'model.simple_dbt_project.fct_daily_sales' was properly closed.
[0m12:27:13.285584 [info ] [MainThread]: 
[0m12:27:13.285901 [info ] [MainThread]: Finished running 2 view models, 2 table models in 0 hours 0 minutes and 0.26 seconds (0.26s).
[0m12:27:13.286871 [debug] [MainThread]: Command end result
[0m12:27:13.295149 [info ] [MainThread]: 
[0m12:27:13.295539 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m12:27:13.295994 [info ] [MainThread]: 
[0m12:27:13.297043 [error] [MainThread]:   Database Error in model fct_customer_purchase_patterns (models/marts/fct_customer_purchase_patterns.sql)
  function date_diff(unknown, date, date) does not exist
  LINE 43:             DATE_DIFF('day', previous_order_date, order_date...
                       ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled Code at target/run/simple_dbt_project/models/marts/fct_customer_purchase_patterns.sql
[0m12:27:13.297789 [info ] [MainThread]: 
[0m12:27:13.298271 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m12:27:13.299737 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.5895528, "process_user_time": 2.145756, "process_kernel_time": 0.302965, "process_mem_max_rss": "142576", "process_out_blocks": "1661", "command_success": false, "process_in_blocks": "0"}
[0m12:27:13.300241 [debug] [MainThread]: Command `dbt run` failed at 12:27:13.300149 after 0.59 seconds
[0m12:27:13.300557 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8bde9f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff884da3a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff887db160>]}
[0m12:27:13.300885 [debug] [MainThread]: Flushing usage events
[0m12:27:53.303170 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb03abf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffada04d00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffada04ca0>]}


============================== 12:27:53.308186 | 71e5653f-02cf-4f1b-8a74-6ea01655c91b ==============================
[0m12:27:53.308186 [info ] [MainThread]: Running with dbt=1.7.3
[0m12:27:53.309118 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'profiles_dir': '.', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir .', 'send_anonymous_usage_stats': 'True'}
[0m12:27:53.463753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '71e5653f-02cf-4f1b-8a74-6ea01655c91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffada04670>]}
[0m12:27:53.515993 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '71e5653f-02cf-4f1b-8a74-6ea01655c91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb2b8f940>]}
[0m12:27:53.516678 [info ] [MainThread]: Registered adapter: postgres=1.7.3
[0m12:27:53.522596 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m12:27:53.550906 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:27:53.551552 [debug] [MainThread]: Partial parsing: updated file: simple_dbt_project://models/marts/fct_customer_purchase_patterns.sql
[0m12:27:53.639687 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '71e5653f-02cf-4f1b-8a74-6ea01655c91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffac7cc730>]}
[0m12:27:53.651629 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '71e5653f-02cf-4f1b-8a74-6ea01655c91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffacc5abb0>]}
[0m12:27:53.652106 [info ] [MainThread]: Found 4 models, 5 tests, 1 source, 0 exposures, 0 metrics, 402 macros, 0 groups, 0 semantic models
[0m12:27:53.652631 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '71e5653f-02cf-4f1b-8a74-6ea01655c91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffacc5ae20>]}
[0m12:27:53.653726 [info ] [MainThread]: 
[0m12:27:53.654524 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:27:53.655468 [debug] [ThreadPool]: Acquiring new postgres connection 'list_airflow'
[0m12:27:53.662296 [debug] [ThreadPool]: Using postgres connection "list_airflow"
[0m12:27:53.662790 [debug] [ThreadPool]: On list_airflow: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_airflow"} */

    select distinct nspname from pg_namespace
  
[0m12:27:53.663078 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:27:53.668200 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.0 seconds
[0m12:27:53.669194 [debug] [ThreadPool]: On list_airflow: Close
[0m12:27:53.671282 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_airflow, now list_airflow_public)
[0m12:27:53.676175 [debug] [ThreadPool]: Using postgres connection "list_airflow_public"
[0m12:27:53.676618 [debug] [ThreadPool]: On list_airflow_public: BEGIN
[0m12:27:53.676881 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:27:53.679471 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m12:27:53.679925 [debug] [ThreadPool]: Using postgres connection "list_airflow_public"
[0m12:27:53.680274 [debug] [ThreadPool]: On list_airflow_public: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_airflow_public"} */
select
      'airflow' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'airflow' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'airflow' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m12:27:53.683171 [debug] [ThreadPool]: SQL status: SELECT 45 in 0.0 seconds
[0m12:27:53.684649 [debug] [ThreadPool]: On list_airflow_public: ROLLBACK
[0m12:27:53.685064 [debug] [ThreadPool]: On list_airflow_public: Close
[0m12:27:53.693097 [debug] [MainThread]: Using postgres connection "master"
[0m12:27:53.693508 [debug] [MainThread]: On master: BEGIN
[0m12:27:53.693763 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:27:53.696349 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:27:53.696721 [debug] [MainThread]: Using postgres connection "master"
[0m12:27:53.697038 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:27:53.701269 [debug] [MainThread]: SQL status: SELECT 1 in 0.0 seconds
[0m12:27:53.702194 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '71e5653f-02cf-4f1b-8a74-6ea01655c91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffacbece80>]}
[0m12:27:53.702569 [debug] [MainThread]: On master: ROLLBACK
[0m12:27:53.702927 [debug] [MainThread]: Using postgres connection "master"
[0m12:27:53.703196 [debug] [MainThread]: On master: BEGIN
[0m12:27:53.703632 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:27:53.703926 [debug] [MainThread]: On master: COMMIT
[0m12:27:53.704256 [debug] [MainThread]: Using postgres connection "master"
[0m12:27:53.704535 [debug] [MainThread]: On master: COMMIT
[0m12:27:53.704874 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m12:27:53.705154 [debug] [MainThread]: On master: Close
[0m12:27:53.705659 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:27:53.705991 [info ] [MainThread]: 
[0m12:27:53.711598 [debug] [Thread-1  ]: Began running node model.simple_dbt_project.my_first_model
[0m12:27:53.711969 [debug] [Thread-2  ]: Began running node model.simple_dbt_project.stg_orders
[0m12:27:53.712368 [info ] [Thread-1  ]: 1 of 4 START sql view model public.my_first_model .............................. [RUN]
[0m12:27:53.712809 [info ] [Thread-2  ]: 2 of 4 START sql view model public.stg_orders .................................. [RUN]
[0m12:27:53.713696 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_airflow_public, now model.simple_dbt_project.my_first_model)
[0m12:27:53.714287 [debug] [Thread-2  ]: Acquiring new postgres connection 'model.simple_dbt_project.stg_orders'
[0m12:27:53.714647 [debug] [Thread-1  ]: Began compiling node model.simple_dbt_project.my_first_model
[0m12:27:53.714999 [debug] [Thread-2  ]: Began compiling node model.simple_dbt_project.stg_orders
[0m12:27:53.720006 [debug] [Thread-1  ]: Writing injected SQL for node "model.simple_dbt_project.my_first_model"
[0m12:27:53.723136 [debug] [Thread-2  ]: Writing injected SQL for node "model.simple_dbt_project.stg_orders"
[0m12:27:53.724662 [debug] [Thread-1  ]: Timing info for model.simple_dbt_project.my_first_model (compile): 12:27:53.715233 => 12:27:53.724447
[0m12:27:53.725117 [debug] [Thread-1  ]: Began executing node model.simple_dbt_project.my_first_model
[0m12:27:53.725515 [debug] [Thread-2  ]: Timing info for model.simple_dbt_project.stg_orders (compile): 12:27:53.720567 => 12:27:53.725341
[0m12:27:53.743267 [debug] [Thread-2  ]: Began executing node model.simple_dbt_project.stg_orders
[0m12:27:53.761062 [debug] [Thread-1  ]: Writing runtime sql for node "model.simple_dbt_project.my_first_model"
[0m12:27:53.761804 [debug] [Thread-2  ]: Writing runtime sql for node "model.simple_dbt_project.stg_orders"
[0m12:27:53.762833 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:27:53.763161 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:27:53.764041 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: BEGIN
[0m12:27:53.764353 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m12:27:53.763513 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: BEGIN
[0m12:27:53.764966 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:27:53.767143 [debug] [Thread-2  ]: SQL status: BEGIN in 0.0 seconds
[0m12:27:53.767515 [debug] [Thread-1  ]: SQL status: BEGIN in 0.0 seconds
[0m12:27:53.768090 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:27:53.768411 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.my_first_model"} */

  create view "airflow"."public"."my_first_model__dbt_tmp"
    
    
  as (
    -- Simple example model
SELECT 1 as id, 'Example' as name
UNION ALL
SELECT 2 as id, 'Test' as name
  );
[0m12:27:53.767760 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:27:53.768834 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.stg_orders"} */

  create view "airflow"."public"."stg_orders__dbt_tmp"
    
    
  as (
    

-- Staging model to clean and standardize raw orders data
SELECT
    order_id,
    customer_id,
    CAST(order_date AS DATE) as order_date,
    status,
    amount,
    CURRENT_TIMESTAMP as loaded_at
FROM "airflow"."raw"."orders"  -- This would point to your raw orders table
  );
[0m12:27:53.770264 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.0 seconds
[0m12:27:53.770561 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.0 seconds
[0m12:27:53.775112 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:27:53.778439 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.stg_orders"} */
alter table "airflow"."public"."stg_orders" rename to "stg_orders__dbt_backup"
[0m12:27:53.777952 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:27:53.778892 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.my_first_model"} */
alter table "airflow"."public"."my_first_model" rename to "my_first_model__dbt_backup"
[0m12:27:53.779218 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:27:53.781669 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:27:53.782329 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.stg_orders"} */
alter table "airflow"."public"."stg_orders__dbt_tmp" rename to "stg_orders"
[0m12:27:53.782087 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:27:53.784601 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:27:53.785141 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.my_first_model"} */
alter table "airflow"."public"."my_first_model__dbt_tmp" rename to "my_first_model"
[0m12:27:53.784904 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:27:53.793053 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:27:53.795843 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: COMMIT
[0m12:27:53.797214 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:27:53.797508 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: COMMIT
[0m12:27:53.796836 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: COMMIT
[0m12:27:53.797881 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:27:53.798219 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: COMMIT
[0m12:27:53.798575 [debug] [Thread-2  ]: SQL status: COMMIT in 0.0 seconds
[0m12:27:53.804024 [debug] [Thread-2  ]: Applying DROP to: "airflow"."public"."stg_orders__dbt_backup"
[0m12:27:53.804425 [debug] [Thread-1  ]: SQL status: COMMIT in 0.0 seconds
[0m12:27:53.807294 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:27:53.809564 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.stg_orders"} */
drop view if exists "airflow"."public"."stg_orders__dbt_backup" cascade
[0m12:27:53.809228 [debug] [Thread-1  ]: Applying DROP to: "airflow"."public"."my_first_model__dbt_backup"
[0m12:27:53.810239 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:27:53.810579 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.my_first_model"} */
drop view if exists "airflow"."public"."my_first_model__dbt_backup" cascade
[0m12:27:53.811051 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.0 seconds
[0m12:27:53.812151 [debug] [Thread-2  ]: Timing info for model.simple_dbt_project.stg_orders (execute): 12:27:53.749280 => 12:27:53.811990
[0m12:27:53.812692 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: Close
[0m12:27:53.813311 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '71e5653f-02cf-4f1b-8a74-6ea01655c91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffac791280>]}
[0m12:27:53.812440 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.0 seconds
[0m12:27:53.813865 [info ] [Thread-2  ]: 2 of 4 OK created sql view model public.stg_orders ............................. [[32mCREATE VIEW[0m in 0.10s]
[0m12:27:53.816649 [debug] [Thread-2  ]: Finished running node model.simple_dbt_project.stg_orders
[0m12:27:53.816120 [debug] [Thread-1  ]: Timing info for model.simple_dbt_project.my_first_model (execute): 12:27:53.725699 => 12:27:53.815939
[0m12:27:53.817302 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: Close
[0m12:27:53.817698 [debug] [Thread-4  ]: Began running node model.simple_dbt_project.fct_customer_purchase_patterns
[0m12:27:53.818162 [debug] [Thread-3  ]: Began running node model.simple_dbt_project.fct_daily_sales
[0m12:27:53.818780 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '71e5653f-02cf-4f1b-8a74-6ea01655c91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffac3916a0>]}
[0m12:27:53.819243 [info ] [Thread-4  ]: 3 of 4 START sql table model public.fct_customer_purchase_patterns ............. [RUN]
[0m12:27:53.819822 [info ] [Thread-3  ]: 4 of 4 START sql table model public.fct_daily_sales ............................ [RUN]
[0m12:27:53.820921 [info ] [Thread-1  ]: 1 of 4 OK created sql view model public.my_first_model ......................... [[32mCREATE VIEW[0m in 0.11s]
[0m12:27:53.821603 [debug] [Thread-4  ]: Acquiring new postgres connection 'model.simple_dbt_project.fct_customer_purchase_patterns'
[0m12:27:53.822277 [debug] [Thread-3  ]: Acquiring new postgres connection 'model.simple_dbt_project.fct_daily_sales'
[0m12:27:53.822779 [debug] [Thread-1  ]: Finished running node model.simple_dbt_project.my_first_model
[0m12:27:53.823136 [debug] [Thread-4  ]: Began compiling node model.simple_dbt_project.fct_customer_purchase_patterns
[0m12:27:53.823483 [debug] [Thread-3  ]: Began compiling node model.simple_dbt_project.fct_daily_sales
[0m12:27:53.826221 [debug] [Thread-4  ]: Writing injected SQL for node "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:27:53.829076 [debug] [Thread-3  ]: Writing injected SQL for node "model.simple_dbt_project.fct_daily_sales"
[0m12:27:53.830546 [debug] [Thread-4  ]: Timing info for model.simple_dbt_project.fct_customer_purchase_patterns (compile): 12:27:53.823852 => 12:27:53.830308
[0m12:27:53.830945 [debug] [Thread-3  ]: Timing info for model.simple_dbt_project.fct_daily_sales (compile): 12:27:53.826683 => 12:27:53.830780
[0m12:27:53.831590 [debug] [Thread-3  ]: Began executing node model.simple_dbt_project.fct_daily_sales
[0m12:27:53.831256 [debug] [Thread-4  ]: Began executing node model.simple_dbt_project.fct_customer_purchase_patterns
[0m12:27:53.849168 [debug] [Thread-3  ]: Writing runtime sql for node "model.simple_dbt_project.fct_daily_sales"
[0m12:27:53.852502 [debug] [Thread-4  ]: Writing runtime sql for node "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:27:53.853576 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:27:53.853900 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: BEGIN
[0m12:27:53.854188 [debug] [Thread-4  ]: Using postgres connection "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:27:53.854695 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: BEGIN
[0m12:27:53.854954 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m12:27:53.854418 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m12:27:53.857968 [debug] [Thread-3  ]: SQL status: BEGIN in 0.0 seconds
[0m12:27:53.858620 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:27:53.858921 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_daily_sales"} */

  
    

  create  table "airflow"."public"."fct_daily_sales__dbt_tmp"
  
  
    as
  
  (
    

WITH daily_sales AS (
    SELECT
        DATE_TRUNC('day', order_date) as date,
        COUNT(DISTINCT order_id) as total_orders,
        COUNT(DISTINCT customer_id) as unique_customers,
        SUM(amount) as total_amount
    FROM "airflow"."public"."stg_orders"
    WHERE status = 'completed'
    GROUP BY 1
)

SELECT
    date,
    total_orders,
    unique_customers,
    total_amount,
    total_amount / NULLIF(total_orders, 0) as avg_order_value,
    total_amount / NULLIF(unique_customers, 0) as avg_customer_spend
FROM daily_sales
  );
  
[0m12:27:53.858369 [debug] [Thread-4  ]: SQL status: BEGIN in 0.0 seconds
[0m12:27:53.859357 [debug] [Thread-4  ]: Using postgres connection "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:27:53.859818 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_customer_purchase_patterns"} */

  
    

  create  table "airflow"."public"."fct_customer_purchase_patterns__dbt_tmp"
  
  
    as
  
  (
    

WITH customer_orders AS (
    SELECT
        customer_id,
        order_date,
        amount,
        LAG(order_date) OVER (
            PARTITION BY customer_id 
            ORDER BY order_date
        ) as previous_order_date
    FROM "airflow"."public"."stg_orders"
),

customer_metrics AS (
    SELECT
        customer_id,
        COUNT(*) as total_orders,
        SUM(amount) as total_amount,
        MIN(order_date) as first_order_date,
        MAX(order_date) as last_order_date,
        AVG(amount) as avg_order_amount,
        -- Use PostgreSQL's date subtraction instead of DATE_DIFF
        AVG(
            CASE 
                WHEN previous_order_date IS NOT NULL 
                THEN (order_date - previous_order_date)
            END
        ) as avg_days_between_orders
    FROM customer_orders
    GROUP BY customer_id
)

SELECT
    customer_id,
    total_orders,
    total_amount,
    first_order_date,
    last_order_date,
    avg_order_amount,
    EXTRACT(epoch FROM avg_days_between_orders) / 86400 as avg_days_between_orders,
    CASE
        WHEN total_orders >= 10 THEN 'High'
        WHEN total_orders >= 5 THEN 'Medium'
        ELSE 'Low'
    END as frequency_segment,
    CASE
        WHEN avg_order_amount >= 200 THEN 'Premium'
        WHEN avg_order_amount >= 100 THEN 'Standard'
        ELSE 'Basic'
    END as value_segment
FROM customer_metrics
  );
  
[0m12:27:53.861754 [debug] [Thread-4  ]: Postgres adapter: Postgres error: function pg_catalog.date_part(unknown, numeric) does not exist
LINE 52:     EXTRACT(epoch FROM avg_days_between_orders) / 86400 as a...
             ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.

[0m12:27:53.862232 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: ROLLBACK
[0m12:27:53.862836 [debug] [Thread-4  ]: Timing info for model.simple_dbt_project.fct_customer_purchase_patterns (execute): 12:27:53.849432 => 12:27:53.862654
[0m12:27:53.863454 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: Close
[0m12:27:53.863185 [debug] [Thread-3  ]: SQL status: SELECT 2 in 0.0 seconds
[0m12:27:53.865848 [debug] [Thread-4  ]: Database Error in model fct_customer_purchase_patterns (models/marts/fct_customer_purchase_patterns.sql)
  function pg_catalog.date_part(unknown, numeric) does not exist
  LINE 52:     EXTRACT(epoch FROM avg_days_between_orders) / 86400 as a...
               ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled Code at target/run/simple_dbt_project/models/marts/fct_customer_purchase_patterns.sql
[0m12:27:53.870476 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '71e5653f-02cf-4f1b-8a74-6ea01655c91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffac7ba940>]}
[0m12:27:53.869874 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:27:53.871463 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_daily_sales"} */
alter table "airflow"."public"."fct_daily_sales" rename to "fct_daily_sales__dbt_backup"
[0m12:27:53.871073 [error] [Thread-4  ]: 3 of 4 ERROR creating sql table model public.fct_customer_purchase_patterns .... [[31mERROR[0m in 0.05s]
[0m12:27:53.872260 [debug] [Thread-4  ]: Finished running node model.simple_dbt_project.fct_customer_purchase_patterns
[0m12:27:53.872569 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:27:53.875132 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:27:53.875530 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_daily_sales"} */
alter table "airflow"."public"."fct_daily_sales__dbt_tmp" rename to "fct_daily_sales"
[0m12:27:53.876067 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:27:53.879736 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: COMMIT
[0m12:27:53.880368 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:27:53.880699 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: COMMIT
[0m12:27:53.881792 [debug] [Thread-3  ]: SQL status: COMMIT in 0.0 seconds
[0m12:27:53.883989 [debug] [Thread-3  ]: Applying DROP to: "airflow"."public"."fct_daily_sales__dbt_backup"
[0m12:27:53.885959 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:27:53.886485 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_daily_sales"} */
drop table if exists "airflow"."public"."fct_daily_sales__dbt_backup" cascade
[0m12:27:53.891065 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.0 seconds
[0m12:27:53.892699 [debug] [Thread-3  ]: Timing info for model.simple_dbt_project.fct_daily_sales (execute): 12:27:53.831778 => 12:27:53.892524
[0m12:27:53.893127 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: Close
[0m12:27:53.893842 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '71e5653f-02cf-4f1b-8a74-6ea01655c91b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffac78b670>]}
[0m12:27:53.894425 [info ] [Thread-3  ]: 4 of 4 OK created sql table model public.fct_daily_sales ....................... [[32mSELECT 2[0m in 0.07s]
[0m12:27:53.895032 [debug] [Thread-3  ]: Finished running node model.simple_dbt_project.fct_daily_sales
[0m12:27:53.896370 [debug] [MainThread]: Using postgres connection "master"
[0m12:27:53.897490 [debug] [MainThread]: On master: BEGIN
[0m12:27:53.898067 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:27:53.901061 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:27:53.901652 [debug] [MainThread]: On master: COMMIT
[0m12:27:53.901927 [debug] [MainThread]: Using postgres connection "master"
[0m12:27:53.902522 [debug] [MainThread]: On master: COMMIT
[0m12:27:53.903248 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m12:27:53.903559 [debug] [MainThread]: On master: Close
[0m12:27:53.904119 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:27:53.904407 [debug] [MainThread]: Connection 'model.simple_dbt_project.my_first_model' was properly closed.
[0m12:27:53.904673 [debug] [MainThread]: Connection 'model.simple_dbt_project.stg_orders' was properly closed.
[0m12:27:53.904902 [debug] [MainThread]: Connection 'model.simple_dbt_project.fct_customer_purchase_patterns' was properly closed.
[0m12:27:53.905163 [debug] [MainThread]: Connection 'model.simple_dbt_project.fct_daily_sales' was properly closed.
[0m12:27:53.905481 [info ] [MainThread]: 
[0m12:27:53.905830 [info ] [MainThread]: Finished running 2 view models, 2 table models in 0 hours 0 minutes and 0.25 seconds (0.25s).
[0m12:27:53.906775 [debug] [MainThread]: Command end result
[0m12:27:53.916158 [info ] [MainThread]: 
[0m12:27:53.916621 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m12:27:53.916995 [info ] [MainThread]: 
[0m12:27:53.917519 [error] [MainThread]:   Database Error in model fct_customer_purchase_patterns (models/marts/fct_customer_purchase_patterns.sql)
  function pg_catalog.date_part(unknown, numeric) does not exist
  LINE 52:     EXTRACT(epoch FROM avg_days_between_orders) / 86400 as a...
               ^
  HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
  compiled Code at target/run/simple_dbt_project/models/marts/fct_customer_purchase_patterns.sql
[0m12:27:53.917923 [info ] [MainThread]: 
[0m12:27:53.918622 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m12:27:53.919750 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.6427755, "process_user_time": 2.135257, "process_kernel_time": 0.19993, "process_mem_max_rss": "142632", "process_out_blocks": "2444", "command_success": false, "process_in_blocks": "0"}
[0m12:27:53.920322 [debug] [MainThread]: Command `dbt run` failed at 12:27:53.920212 after 0.64 seconds
[0m12:27:53.920662 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb03abf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb2b8f940>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xfffface0c160>]}
[0m12:27:53.920992 [debug] [MainThread]: Flushing usage events
[0m12:28:24.975740 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9176afd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8ed42790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8ed42d00>]}


============================== 12:28:24.980401 | 34a42b75-322c-41ce-bfad-7d9d37482217 ==============================
[0m12:28:24.980401 [info ] [MainThread]: Running with dbt=1.7.3
[0m12:28:24.981098 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'profiles_dir': '.', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --profiles-dir .', 'send_anonymous_usage_stats': 'True'}
[0m12:28:25.129012 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '34a42b75-322c-41ce-bfad-7d9d37482217', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8ee05d60>]}
[0m12:28:25.181671 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '34a42b75-322c-41ce-bfad-7d9d37482217', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8ee2d970>]}
[0m12:28:25.182341 [info ] [MainThread]: Registered adapter: postgres=1.7.3
[0m12:28:25.188130 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m12:28:25.214358 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:28:25.215070 [debug] [MainThread]: Partial parsing: updated file: simple_dbt_project://models/marts/fct_customer_purchase_patterns.sql
[0m12:28:25.301956 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '34a42b75-322c-41ce-bfad-7d9d37482217', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8dd0b700>]}
[0m12:28:25.315640 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '34a42b75-322c-41ce-bfad-7d9d37482217', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8df62b80>]}
[0m12:28:25.316102 [info ] [MainThread]: Found 4 models, 5 tests, 1 source, 0 exposures, 0 metrics, 402 macros, 0 groups, 0 semantic models
[0m12:28:25.316666 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '34a42b75-322c-41ce-bfad-7d9d37482217', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8df62df0>]}
[0m12:28:25.317794 [info ] [MainThread]: 
[0m12:28:25.318921 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:28:25.319989 [debug] [ThreadPool]: Acquiring new postgres connection 'list_airflow'
[0m12:28:25.327131 [debug] [ThreadPool]: Using postgres connection "list_airflow"
[0m12:28:25.327643 [debug] [ThreadPool]: On list_airflow: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_airflow"} */

    select distinct nspname from pg_namespace
  
[0m12:28:25.327924 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:28:25.332981 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.0 seconds
[0m12:28:25.334053 [debug] [ThreadPool]: On list_airflow: Close
[0m12:28:25.336179 [debug] [ThreadPool]: Acquiring new postgres connection 'list_airflow_public'
[0m12:28:25.340551 [debug] [ThreadPool]: Using postgres connection "list_airflow_public"
[0m12:28:25.340930 [debug] [ThreadPool]: On list_airflow_public: BEGIN
[0m12:28:25.341177 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:28:25.343747 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m12:28:25.344319 [debug] [ThreadPool]: Using postgres connection "list_airflow_public"
[0m12:28:25.344696 [debug] [ThreadPool]: On list_airflow_public: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_airflow_public"} */
select
      'airflow' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'airflow' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'airflow' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m12:28:25.348549 [debug] [ThreadPool]: SQL status: SELECT 45 in 0.0 seconds
[0m12:28:25.350051 [debug] [ThreadPool]: On list_airflow_public: ROLLBACK
[0m12:28:25.350443 [debug] [ThreadPool]: On list_airflow_public: Close
[0m12:28:25.358258 [debug] [MainThread]: Using postgres connection "master"
[0m12:28:25.358671 [debug] [MainThread]: On master: BEGIN
[0m12:28:25.358947 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:28:25.361387 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:28:25.361762 [debug] [MainThread]: Using postgres connection "master"
[0m12:28:25.362067 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:28:25.366429 [debug] [MainThread]: SQL status: SELECT 1 in 0.0 seconds
[0m12:28:25.367363 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '34a42b75-322c-41ce-bfad-7d9d37482217', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8def8eb0>]}
[0m12:28:25.367733 [debug] [MainThread]: On master: ROLLBACK
[0m12:28:25.368091 [debug] [MainThread]: Using postgres connection "master"
[0m12:28:25.368363 [debug] [MainThread]: On master: BEGIN
[0m12:28:25.368806 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:28:25.369113 [debug] [MainThread]: On master: COMMIT
[0m12:28:25.369425 [debug] [MainThread]: Using postgres connection "master"
[0m12:28:25.369736 [debug] [MainThread]: On master: COMMIT
[0m12:28:25.370103 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m12:28:25.370393 [debug] [MainThread]: On master: Close
[0m12:28:25.370915 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:28:25.371247 [info ] [MainThread]: 
[0m12:28:25.376902 [debug] [Thread-1  ]: Began running node model.simple_dbt_project.my_first_model
[0m12:28:25.377621 [info ] [Thread-1  ]: 1 of 4 START sql view model public.my_first_model .............................. [RUN]
[0m12:28:25.377297 [debug] [Thread-2  ]: Began running node model.simple_dbt_project.stg_orders
[0m12:28:25.378191 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_airflow_public, now model.simple_dbt_project.my_first_model)
[0m12:28:25.378626 [info ] [Thread-2  ]: 2 of 4 START sql view model public.stg_orders .................................. [RUN]
[0m12:28:25.379030 [debug] [Thread-1  ]: Began compiling node model.simple_dbt_project.my_first_model
[0m12:28:25.379604 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly list_airflow, now model.simple_dbt_project.stg_orders)
[0m12:28:25.384286 [debug] [Thread-1  ]: Writing injected SQL for node "model.simple_dbt_project.my_first_model"
[0m12:28:25.384716 [debug] [Thread-2  ]: Began compiling node model.simple_dbt_project.stg_orders
[0m12:28:25.387036 [debug] [Thread-2  ]: Writing injected SQL for node "model.simple_dbt_project.stg_orders"
[0m12:28:25.388196 [debug] [Thread-1  ]: Timing info for model.simple_dbt_project.my_first_model (compile): 12:28:25.379875 => 12:28:25.388005
[0m12:28:25.388579 [debug] [Thread-2  ]: Timing info for model.simple_dbt_project.stg_orders (compile): 12:28:25.385114 => 12:28:25.388424
[0m12:28:25.389169 [debug] [Thread-2  ]: Began executing node model.simple_dbt_project.stg_orders
[0m12:28:25.388839 [debug] [Thread-1  ]: Began executing node model.simple_dbt_project.my_first_model
[0m12:28:25.419423 [debug] [Thread-2  ]: Writing runtime sql for node "model.simple_dbt_project.stg_orders"
[0m12:28:25.420884 [debug] [Thread-1  ]: Writing runtime sql for node "model.simple_dbt_project.my_first_model"
[0m12:28:25.421989 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:28:25.422383 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: BEGIN
[0m12:28:25.422693 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:28:25.423266 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: BEGIN
[0m12:28:25.423551 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:28:25.422940 [debug] [Thread-2  ]: Opening a new connection, currently in state closed
[0m12:28:25.426258 [debug] [Thread-1  ]: SQL status: BEGIN in 0.0 seconds
[0m12:28:25.426961 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:28:25.427319 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.my_first_model"} */

  create view "airflow"."public"."my_first_model__dbt_tmp"
    
    
  as (
    -- Simple example model
SELECT 1 as id, 'Example' as name
UNION ALL
SELECT 2 as id, 'Test' as name
  );
[0m12:28:25.426683 [debug] [Thread-2  ]: SQL status: BEGIN in 0.0 seconds
[0m12:28:25.427728 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:28:25.428133 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.stg_orders"} */

  create view "airflow"."public"."stg_orders__dbt_tmp"
    
    
  as (
    

-- Staging model to clean and standardize raw orders data
SELECT
    order_id,
    customer_id,
    CAST(order_date AS DATE) as order_date,
    status,
    amount,
    CURRENT_TIMESTAMP as loaded_at
FROM "airflow"."raw"."orders"  -- This would point to your raw orders table
  );
[0m12:28:25.429455 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.0 seconds
[0m12:28:25.429781 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.0 seconds
[0m12:28:25.434570 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:28:25.437571 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.stg_orders"} */
alter table "airflow"."public"."stg_orders" rename to "stg_orders__dbt_backup"
[0m12:28:25.437151 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:28:25.438004 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.my_first_model"} */
alter table "airflow"."public"."my_first_model" rename to "my_first_model__dbt_backup"
[0m12:28:25.438335 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:28:25.440559 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:28:25.441100 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.stg_orders"} */
alter table "airflow"."public"."stg_orders__dbt_tmp" rename to "stg_orders"
[0m12:28:25.440867 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:28:25.443281 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:28:25.443845 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.my_first_model"} */
alter table "airflow"."public"."my_first_model__dbt_tmp" rename to "my_first_model"
[0m12:28:25.443580 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:28:25.453940 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: COMMIT
[0m12:28:25.454563 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:28:25.454841 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: COMMIT
[0m12:28:25.454323 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:28:25.456134 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: COMMIT
[0m12:28:25.456681 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:28:25.456986 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: COMMIT
[0m12:28:25.456455 [debug] [Thread-2  ]: SQL status: COMMIT in 0.0 seconds
[0m12:28:25.462186 [debug] [Thread-2  ]: Applying DROP to: "airflow"."public"."stg_orders__dbt_backup"
[0m12:28:25.462553 [debug] [Thread-1  ]: SQL status: COMMIT in 0.0 seconds
[0m12:28:25.465149 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:28:25.467356 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.stg_orders"} */
drop view if exists "airflow"."public"."stg_orders__dbt_backup" cascade
[0m12:28:25.466975 [debug] [Thread-1  ]: Applying DROP to: "airflow"."public"."my_first_model__dbt_backup"
[0m12:28:25.468045 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:28:25.468423 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.my_first_model"} */
drop view if exists "airflow"."public"."my_first_model__dbt_backup" cascade
[0m12:28:25.468689 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.0 seconds
[0m12:28:25.469799 [debug] [Thread-2  ]: Timing info for model.simple_dbt_project.stg_orders (execute): 12:28:25.389380 => 12:28:25.469658
[0m12:28:25.470343 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: Close
[0m12:28:25.470927 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '34a42b75-322c-41ce-bfad-7d9d37482217', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8dce2040>]}
[0m12:28:25.471477 [info ] [Thread-2  ]: 2 of 4 OK created sql view model public.stg_orders ............................. [[32mCREATE VIEW[0m in 0.09s]
[0m12:28:25.471986 [debug] [Thread-2  ]: Finished running node model.simple_dbt_project.stg_orders
[0m12:28:25.470083 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.0 seconds
[0m12:28:25.473535 [debug] [Thread-1  ]: Timing info for model.simple_dbt_project.my_first_model (execute): 12:28:25.407854 => 12:28:25.473382
[0m12:28:25.473923 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: Close
[0m12:28:25.474305 [debug] [Thread-4  ]: Began running node model.simple_dbt_project.fct_customer_purchase_patterns
[0m12:28:25.474640 [debug] [Thread-3  ]: Began running node model.simple_dbt_project.fct_daily_sales
[0m12:28:25.475244 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '34a42b75-322c-41ce-bfad-7d9d37482217', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8dce9d00>]}
[0m12:28:25.475653 [info ] [Thread-4  ]: 3 of 4 START sql table model public.fct_customer_purchase_patterns ............. [RUN]
[0m12:28:25.476207 [info ] [Thread-3  ]: 4 of 4 START sql table model public.fct_daily_sales ............................ [RUN]
[0m12:28:25.477009 [info ] [Thread-1  ]: 1 of 4 OK created sql view model public.my_first_model ......................... [[32mCREATE VIEW[0m in 0.10s]
[0m12:28:25.477677 [debug] [Thread-4  ]: Acquiring new postgres connection 'model.simple_dbt_project.fct_customer_purchase_patterns'
[0m12:28:25.478663 [debug] [Thread-3  ]: Acquiring new postgres connection 'model.simple_dbt_project.fct_daily_sales'
[0m12:28:25.479349 [debug] [Thread-1  ]: Finished running node model.simple_dbt_project.my_first_model
[0m12:28:25.479916 [debug] [Thread-4  ]: Began compiling node model.simple_dbt_project.fct_customer_purchase_patterns
[0m12:28:25.480299 [debug] [Thread-3  ]: Began compiling node model.simple_dbt_project.fct_daily_sales
[0m12:28:25.483028 [debug] [Thread-4  ]: Writing injected SQL for node "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:28:25.485230 [debug] [Thread-3  ]: Writing injected SQL for node "model.simple_dbt_project.fct_daily_sales"
[0m12:28:25.486681 [debug] [Thread-3  ]: Timing info for model.simple_dbt_project.fct_daily_sales (compile): 12:28:25.483357 => 12:28:25.486498
[0m12:28:25.487011 [debug] [Thread-4  ]: Timing info for model.simple_dbt_project.fct_customer_purchase_patterns (compile): 12:28:25.480702 => 12:28:25.486874
[0m12:28:25.487684 [debug] [Thread-4  ]: Began executing node model.simple_dbt_project.fct_customer_purchase_patterns
[0m12:28:25.487325 [debug] [Thread-3  ]: Began executing node model.simple_dbt_project.fct_daily_sales
[0m12:28:25.509344 [debug] [Thread-3  ]: Writing runtime sql for node "model.simple_dbt_project.fct_daily_sales"
[0m12:28:25.509741 [debug] [Thread-4  ]: Writing runtime sql for node "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:28:25.510804 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:28:25.511181 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: BEGIN
[0m12:28:25.511497 [debug] [Thread-4  ]: Using postgres connection "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:28:25.511996 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: BEGIN
[0m12:28:25.512599 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m12:28:25.511722 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m12:28:25.515475 [debug] [Thread-3  ]: SQL status: BEGIN in 0.0 seconds
[0m12:28:25.516104 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:28:25.516449 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_daily_sales"} */

  
    

  create  table "airflow"."public"."fct_daily_sales__dbt_tmp"
  
  
    as
  
  (
    

WITH daily_sales AS (
    SELECT
        DATE_TRUNC('day', order_date) as date,
        COUNT(DISTINCT order_id) as total_orders,
        COUNT(DISTINCT customer_id) as unique_customers,
        SUM(amount) as total_amount
    FROM "airflow"."public"."stg_orders"
    WHERE status = 'completed'
    GROUP BY 1
)

SELECT
    date,
    total_orders,
    unique_customers,
    total_amount,
    total_amount / NULLIF(total_orders, 0) as avg_order_value,
    total_amount / NULLIF(unique_customers, 0) as avg_customer_spend
FROM daily_sales
  );
  
[0m12:28:25.515861 [debug] [Thread-4  ]: SQL status: BEGIN in 0.0 seconds
[0m12:28:25.516848 [debug] [Thread-4  ]: Using postgres connection "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:28:25.517204 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_customer_purchase_patterns"} */

  
    

  create  table "airflow"."public"."fct_customer_purchase_patterns__dbt_tmp"
  
  
    as
  
  (
    

WITH customer_orders AS (
    SELECT
        customer_id,
        order_date,
        amount,
        LAG(order_date) OVER (
            PARTITION BY customer_id 
            ORDER BY order_date
        ) as previous_order_date
    FROM "airflow"."public"."stg_orders"
),

customer_metrics AS (
    SELECT
        customer_id,
        COUNT(*) as total_orders,
        SUM(amount) as total_amount,
        MIN(order_date) as first_order_date,
        MAX(order_date) as last_order_date,
        AVG(amount) as avg_order_amount,
        -- Use PostgreSQL's date subtraction
        AVG(
            CASE 
                WHEN previous_order_date IS NOT NULL 
                THEN DATE_PART('day', order_date::timestamp - previous_order_date::timestamp)
            END
        ) as avg_days_between_orders
    FROM customer_orders
    GROUP BY customer_id
)

SELECT
    customer_id,
    total_orders,
    total_amount,
    first_order_date,
    last_order_date,
    avg_order_amount,
    avg_days_between_orders,
    CASE
        WHEN total_orders >= 10 THEN 'High'
        WHEN total_orders >= 5 THEN 'Medium'
        ELSE 'Low'
    END as frequency_segment,
    CASE
        WHEN avg_order_amount >= 200 THEN 'Premium'
        WHEN avg_order_amount >= 100 THEN 'Standard'
        ELSE 'Basic'
    END as value_segment
FROM customer_metrics
  );
  
[0m12:28:25.520607 [debug] [Thread-4  ]: SQL status: SELECT 3 in 0.0 seconds
[0m12:28:25.524087 [debug] [Thread-4  ]: Using postgres connection "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:28:25.524696 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_customer_purchase_patterns"} */
alter table "airflow"."public"."fct_customer_purchase_patterns__dbt_tmp" rename to "fct_customer_purchase_patterns"
[0m12:28:25.524452 [debug] [Thread-3  ]: SQL status: SELECT 2 in 0.0 seconds
[0m12:28:25.527136 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:28:25.527713 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_daily_sales"} */
alter table "airflow"."public"."fct_daily_sales" rename to "fct_daily_sales__dbt_backup"
[0m12:28:25.527465 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:28:25.531032 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: COMMIT
[0m12:28:25.531652 [debug] [Thread-4  ]: Using postgres connection "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:28:25.531983 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: COMMIT
[0m12:28:25.531405 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:28:25.534540 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:28:25.534919 [debug] [Thread-4  ]: SQL status: COMMIT in 0.0 seconds
[0m12:28:25.535261 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_daily_sales"} */
alter table "airflow"."public"."fct_daily_sales__dbt_tmp" rename to "fct_daily_sales"
[0m12:28:25.537203 [debug] [Thread-4  ]: Applying DROP to: "airflow"."public"."fct_customer_purchase_patterns__dbt_backup"
[0m12:28:25.539349 [debug] [Thread-4  ]: Using postgres connection "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:28:25.539931 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_customer_purchase_patterns"} */
drop table if exists "airflow"."public"."fct_customer_purchase_patterns__dbt_backup" cascade
[0m12:28:25.539689 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:28:25.541480 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: COMMIT
[0m12:28:25.542033 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:28:25.542344 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: COMMIT
[0m12:28:25.541799 [debug] [Thread-4  ]: SQL status: DROP TABLE in 0.0 seconds
[0m12:28:25.543497 [debug] [Thread-4  ]: Timing info for model.simple_dbt_project.fct_customer_purchase_patterns (execute): 12:28:25.487898 => 12:28:25.543347
[0m12:28:25.544056 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: Close
[0m12:28:25.543790 [debug] [Thread-3  ]: SQL status: COMMIT in 0.0 seconds
[0m12:28:25.544727 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '34a42b75-322c-41ce-bfad-7d9d37482217', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8d8d0550>]}
[0m12:28:25.547505 [info ] [Thread-4  ]: 3 of 4 OK created sql table model public.fct_customer_purchase_patterns ........ [[32mSELECT 3[0m in 0.07s]
[0m12:28:25.546899 [debug] [Thread-3  ]: Applying DROP to: "airflow"."public"."fct_daily_sales__dbt_backup"
[0m12:28:25.548724 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:28:25.549029 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_daily_sales"} */
drop table if exists "airflow"."public"."fct_daily_sales__dbt_backup" cascade
[0m12:28:25.548054 [debug] [Thread-4  ]: Finished running node model.simple_dbt_project.fct_customer_purchase_patterns
[0m12:28:25.551820 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.0 seconds
[0m12:28:25.553320 [debug] [Thread-3  ]: Timing info for model.simple_dbt_project.fct_daily_sales (execute): 12:28:25.506490 => 12:28:25.553154
[0m12:28:25.553679 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: Close
[0m12:28:25.554311 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '34a42b75-322c-41ce-bfad-7d9d37482217', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8d9b0d60>]}
[0m12:28:25.554793 [info ] [Thread-3  ]: 4 of 4 OK created sql table model public.fct_daily_sales ....................... [[32mSELECT 2[0m in 0.08s]
[0m12:28:25.555281 [debug] [Thread-3  ]: Finished running node model.simple_dbt_project.fct_daily_sales
[0m12:28:25.556562 [debug] [MainThread]: Using postgres connection "master"
[0m12:28:25.556908 [debug] [MainThread]: On master: BEGIN
[0m12:28:25.557193 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:28:25.561521 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:28:25.561932 [debug] [MainThread]: On master: COMMIT
[0m12:28:25.562196 [debug] [MainThread]: Using postgres connection "master"
[0m12:28:25.562452 [debug] [MainThread]: On master: COMMIT
[0m12:28:25.562748 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m12:28:25.562993 [debug] [MainThread]: On master: Close
[0m12:28:25.563490 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:28:25.563744 [debug] [MainThread]: Connection 'model.simple_dbt_project.stg_orders' was properly closed.
[0m12:28:25.563968 [debug] [MainThread]: Connection 'model.simple_dbt_project.my_first_model' was properly closed.
[0m12:28:25.564189 [debug] [MainThread]: Connection 'model.simple_dbt_project.fct_customer_purchase_patterns' was properly closed.
[0m12:28:25.564409 [debug] [MainThread]: Connection 'model.simple_dbt_project.fct_daily_sales' was properly closed.
[0m12:28:25.564728 [info ] [MainThread]: 
[0m12:28:25.565044 [info ] [MainThread]: Finished running 2 view models, 2 table models in 0 hours 0 minutes and 0.25 seconds (0.25s).
[0m12:28:25.565991 [debug] [MainThread]: Command end result
[0m12:28:25.573915 [info ] [MainThread]: 
[0m12:28:25.574400 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:28:25.574822 [info ] [MainThread]: 
[0m12:28:25.575317 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m12:28:25.576175 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.6307503, "process_user_time": 2.120786, "process_kernel_time": 0.180066, "process_mem_max_rss": "142600", "process_out_blocks": "2441", "process_in_blocks": "0"}
[0m12:28:25.576702 [debug] [MainThread]: Command `dbt run` succeeded at 12:28:25.576601 after 0.63 seconds
[0m12:28:25.577017 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9176afd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8dc6f0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8ee05d60>]}
[0m12:28:25.577417 [debug] [MainThread]: Flushing usage events
[0m12:29:14.586642 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85a8ebb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83081d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83081610>]}


============================== 12:29:14.590787 | 7c1740e4-70c4-4aab-8c9b-5b32c77e8a3e ==============================
[0m12:29:14.590787 [info ] [MainThread]: Running with dbt=1.7.3
[0m12:29:14.591649 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '.', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --profiles-dir .', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:29:14.740860 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7c1740e4-70c4-4aab-8c9b-5b32c77e8a3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff848c0100>]}
[0m12:29:14.790722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7c1740e4-70c4-4aab-8c9b-5b32c77e8a3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8245a9d0>]}
[0m12:29:14.791433 [info ] [MainThread]: Registered adapter: postgres=1.7.3
[0m12:29:14.797215 [debug] [MainThread]: checksum: c95636796e12235e48c0560a0bb6a50e98827ef72e7ea1fe07a97c38c91661e1, vars: {}, profile: , target: , version: 1.7.3
[0m12:29:14.821355 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:29:14.821846 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:29:14.826137 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7c1740e4-70c4-4aab-8c9b-5b32c77e8a3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff821caee0>]}
[0m12:29:14.839794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7c1740e4-70c4-4aab-8c9b-5b32c77e8a3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82298cd0>]}
[0m12:29:14.840342 [info ] [MainThread]: Found 4 models, 5 tests, 1 source, 0 exposures, 0 metrics, 402 macros, 0 groups, 0 semantic models
[0m12:29:14.840934 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7c1740e4-70c4-4aab-8c9b-5b32c77e8a3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82298e50>]}
[0m12:29:14.842317 [info ] [MainThread]: 
[0m12:29:14.843183 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:29:14.844527 [debug] [ThreadPool]: Acquiring new postgres connection 'list_airflow'
[0m12:29:14.852486 [debug] [ThreadPool]: Using postgres connection "list_airflow"
[0m12:29:14.852881 [debug] [ThreadPool]: On list_airflow: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_airflow"} */

    select distinct nspname from pg_namespace
  
[0m12:29:14.853122 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:29:14.858346 [debug] [ThreadPool]: SQL status: SELECT 5 in 0.0 seconds
[0m12:29:14.859415 [debug] [ThreadPool]: On list_airflow: Close
[0m12:29:14.860926 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_airflow, now list_airflow_public)
[0m12:29:14.865578 [debug] [ThreadPool]: Using postgres connection "list_airflow_public"
[0m12:29:14.865979 [debug] [ThreadPool]: On list_airflow_public: BEGIN
[0m12:29:14.866219 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:29:14.869041 [debug] [ThreadPool]: SQL status: BEGIN in 0.0 seconds
[0m12:29:14.869512 [debug] [ThreadPool]: Using postgres connection "list_airflow_public"
[0m12:29:14.869838 [debug] [ThreadPool]: On list_airflow_public: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "connection_name": "list_airflow_public"} */
select
      'airflow' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'public'
    union all
    select
      'airflow' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'public'
    union all
    select
      'airflow' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'public'
  
[0m12:29:14.876804 [debug] [ThreadPool]: SQL status: SELECT 46 in 0.0 seconds
[0m12:29:14.878553 [debug] [ThreadPool]: On list_airflow_public: ROLLBACK
[0m12:29:14.878972 [debug] [ThreadPool]: On list_airflow_public: Close
[0m12:29:14.887170 [debug] [MainThread]: Using postgres connection "master"
[0m12:29:14.887516 [debug] [MainThread]: On master: BEGIN
[0m12:29:14.887761 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:29:14.890329 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:29:14.890650 [debug] [MainThread]: Using postgres connection "master"
[0m12:29:14.890940 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:29:14.895154 [debug] [MainThread]: SQL status: SELECT 1 in 0.0 seconds
[0m12:29:14.896004 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7c1740e4-70c4-4aab-8c9b-5b32c77e8a3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff823bbf10>]}
[0m12:29:14.896414 [debug] [MainThread]: On master: ROLLBACK
[0m12:29:14.896760 [debug] [MainThread]: Using postgres connection "master"
[0m12:29:14.897001 [debug] [MainThread]: On master: BEGIN
[0m12:29:14.897383 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:29:14.897657 [debug] [MainThread]: On master: COMMIT
[0m12:29:14.897883 [debug] [MainThread]: Using postgres connection "master"
[0m12:29:14.898100 [debug] [MainThread]: On master: COMMIT
[0m12:29:14.898410 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m12:29:14.898658 [debug] [MainThread]: On master: Close
[0m12:29:14.899144 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:29:14.899569 [info ] [MainThread]: 
[0m12:29:14.905150 [debug] [Thread-1  ]: Began running node model.simple_dbt_project.my_first_model
[0m12:29:14.905516 [debug] [Thread-2  ]: Began running node model.simple_dbt_project.stg_orders
[0m12:29:14.905901 [info ] [Thread-1  ]: 1 of 4 START sql view model public.my_first_model .............................. [RUN]
[0m12:29:14.906308 [info ] [Thread-2  ]: 2 of 4 START sql view model public.stg_orders .................................. [RUN]
[0m12:29:14.906956 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list_airflow_public, now model.simple_dbt_project.my_first_model)
[0m12:29:14.907496 [debug] [Thread-2  ]: Acquiring new postgres connection 'model.simple_dbt_project.stg_orders'
[0m12:29:14.907822 [debug] [Thread-1  ]: Began compiling node model.simple_dbt_project.my_first_model
[0m12:29:14.908137 [debug] [Thread-2  ]: Began compiling node model.simple_dbt_project.stg_orders
[0m12:29:14.912736 [debug] [Thread-1  ]: Writing injected SQL for node "model.simple_dbt_project.my_first_model"
[0m12:29:14.914865 [debug] [Thread-2  ]: Writing injected SQL for node "model.simple_dbt_project.stg_orders"
[0m12:29:14.915877 [debug] [Thread-1  ]: Timing info for model.simple_dbt_project.my_first_model (compile): 12:29:14.908343 => 12:29:14.915723
[0m12:29:14.916244 [debug] [Thread-1  ]: Began executing node model.simple_dbt_project.my_first_model
[0m12:29:14.916572 [debug] [Thread-2  ]: Timing info for model.simple_dbt_project.stg_orders (compile): 12:29:14.912998 => 12:29:14.916436
[0m12:29:14.933818 [debug] [Thread-2  ]: Began executing node model.simple_dbt_project.stg_orders
[0m12:29:14.939245 [debug] [Thread-1  ]: Writing runtime sql for node "model.simple_dbt_project.my_first_model"
[0m12:29:14.942712 [debug] [Thread-2  ]: Writing runtime sql for node "model.simple_dbt_project.stg_orders"
[0m12:29:14.943887 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:29:14.944228 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: BEGIN
[0m12:29:14.944543 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:29:14.945058 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: BEGIN
[0m12:29:14.945335 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m12:29:14.944767 [debug] [Thread-1  ]: Opening a new connection, currently in state closed
[0m12:29:14.947682 [debug] [Thread-1  ]: SQL status: BEGIN in 0.0 seconds
[0m12:29:14.948022 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:29:14.948303 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.my_first_model"} */

  create view "airflow"."public"."my_first_model__dbt_tmp"
    
    
  as (
    -- Simple example model
SELECT 1 as id, 'Example' as name
UNION ALL
SELECT 2 as id, 'Test' as name
  );
[0m12:29:14.949918 [debug] [Thread-2  ]: SQL status: BEGIN in 0.0 seconds
[0m12:29:14.950472 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:29:14.950761 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.stg_orders"} */

  create view "airflow"."public"."stg_orders__dbt_tmp"
    
    
  as (
    

-- Staging model to clean and standardize raw orders data
SELECT
    order_id,
    customer_id,
    CAST(order_date AS DATE) as order_date,
    status,
    amount,
    CURRENT_TIMESTAMP as loaded_at
FROM "airflow"."raw"."orders"  -- This would point to your raw orders table
  );
[0m12:29:14.950222 [debug] [Thread-1  ]: SQL status: CREATE VIEW in 0.0 seconds
[0m12:29:14.955275 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:29:14.955945 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.my_first_model"} */
alter table "airflow"."public"."my_first_model" rename to "my_first_model__dbt_backup"
[0m12:29:14.955666 [debug] [Thread-2  ]: SQL status: CREATE VIEW in 0.0 seconds
[0m12:29:14.958338 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:29:14.959045 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.stg_orders"} */
alter table "airflow"."public"."stg_orders" rename to "stg_orders__dbt_backup"
[0m12:29:14.958732 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:29:14.961033 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:29:14.961522 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.my_first_model"} */
alter table "airflow"."public"."my_first_model__dbt_tmp" rename to "my_first_model"
[0m12:29:14.961296 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:29:14.963446 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:29:14.963930 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.stg_orders"} */
alter table "airflow"."public"."stg_orders__dbt_tmp" rename to "stg_orders"
[0m12:29:14.963715 [debug] [Thread-1  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:29:14.973589 [debug] [Thread-2  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:29:14.974850 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: COMMIT
[0m12:29:14.975152 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:29:14.975428 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: COMMIT
[0m12:29:14.973960 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: COMMIT
[0m12:29:14.975792 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:29:14.976123 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: COMMIT
[0m12:29:14.976437 [debug] [Thread-2  ]: SQL status: COMMIT in 0.0 seconds
[0m12:29:14.980429 [debug] [Thread-2  ]: Applying DROP to: "airflow"."public"."stg_orders__dbt_backup"
[0m12:29:14.980724 [debug] [Thread-1  ]: SQL status: COMMIT in 0.0 seconds
[0m12:29:14.984956 [debug] [Thread-1  ]: Applying DROP to: "airflow"."public"."my_first_model__dbt_backup"
[0m12:29:14.985510 [debug] [Thread-1  ]: Using postgres connection "model.simple_dbt_project.my_first_model"
[0m12:29:14.985864 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.my_first_model"} */
drop view if exists "airflow"."public"."my_first_model__dbt_backup" cascade
[0m12:29:14.983235 [debug] [Thread-2  ]: Using postgres connection "model.simple_dbt_project.stg_orders"
[0m12:29:14.986251 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.stg_orders"} */
drop view if exists "airflow"."public"."stg_orders__dbt_backup" cascade
[0m12:29:14.986965 [debug] [Thread-1  ]: SQL status: DROP VIEW in 0.0 seconds
[0m12:29:14.987252 [debug] [Thread-2  ]: SQL status: DROP VIEW in 0.0 seconds
[0m12:29:14.988360 [debug] [Thread-1  ]: Timing info for model.simple_dbt_project.my_first_model (execute): 12:29:14.916735 => 12:29:14.988213
[0m12:29:14.989787 [debug] [Thread-1  ]: On model.simple_dbt_project.my_first_model: Close
[0m12:29:14.990442 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7c1740e4-70c4-4aab-8c9b-5b32c77e8a3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff820d96d0>]}
[0m12:29:14.990924 [info ] [Thread-1  ]: 1 of 4 OK created sql view model public.my_first_model ......................... [[32mCREATE VIEW[0m in 0.08s]
[0m12:29:14.991439 [debug] [Thread-1  ]: Finished running node model.simple_dbt_project.my_first_model
[0m12:29:14.989486 [debug] [Thread-2  ]: Timing info for model.simple_dbt_project.stg_orders (execute): 12:29:14.939439 => 12:29:14.989337
[0m12:29:14.991979 [debug] [Thread-2  ]: On model.simple_dbt_project.stg_orders: Close
[0m12:29:14.992630 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7c1740e4-70c4-4aab-8c9b-5b32c77e8a3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8209a8b0>]}
[0m12:29:14.993126 [info ] [Thread-2  ]: 2 of 4 OK created sql view model public.stg_orders ............................. [[32mCREATE VIEW[0m in 0.09s]
[0m12:29:14.993947 [debug] [Thread-2  ]: Finished running node model.simple_dbt_project.stg_orders
[0m12:29:14.995440 [debug] [Thread-4  ]: Began running node model.simple_dbt_project.fct_customer_purchase_patterns
[0m12:29:14.995850 [debug] [Thread-3  ]: Began running node model.simple_dbt_project.fct_daily_sales
[0m12:29:14.996392 [info ] [Thread-4  ]: 3 of 4 START sql table model public.fct_customer_purchase_patterns ............. [RUN]
[0m12:29:14.996940 [info ] [Thread-3  ]: 4 of 4 START sql table model public.fct_daily_sales ............................ [RUN]
[0m12:29:14.998034 [debug] [Thread-4  ]: Acquiring new postgres connection 'model.simple_dbt_project.fct_customer_purchase_patterns'
[0m12:29:14.998662 [debug] [Thread-3  ]: Acquiring new postgres connection 'model.simple_dbt_project.fct_daily_sales'
[0m12:29:14.999014 [debug] [Thread-4  ]: Began compiling node model.simple_dbt_project.fct_customer_purchase_patterns
[0m12:29:14.999341 [debug] [Thread-3  ]: Began compiling node model.simple_dbt_project.fct_daily_sales
[0m12:29:15.002733 [debug] [Thread-4  ]: Writing injected SQL for node "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:29:15.004976 [debug] [Thread-3  ]: Writing injected SQL for node "model.simple_dbt_project.fct_daily_sales"
[0m12:29:15.006370 [debug] [Thread-4  ]: Timing info for model.simple_dbt_project.fct_customer_purchase_patterns (compile): 12:29:14.999591 => 12:29:15.006167
[0m12:29:15.006726 [debug] [Thread-3  ]: Timing info for model.simple_dbt_project.fct_daily_sales (compile): 12:29:15.003057 => 12:29:15.006586
[0m12:29:15.007372 [debug] [Thread-3  ]: Began executing node model.simple_dbt_project.fct_daily_sales
[0m12:29:15.007023 [debug] [Thread-4  ]: Began executing node model.simple_dbt_project.fct_customer_purchase_patterns
[0m12:29:15.023674 [debug] [Thread-3  ]: Writing runtime sql for node "model.simple_dbt_project.fct_daily_sales"
[0m12:29:15.026800 [debug] [Thread-4  ]: Writing runtime sql for node "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:29:15.027779 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:29:15.028188 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: BEGIN
[0m12:29:15.028814 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m12:29:15.028552 [debug] [Thread-4  ]: Using postgres connection "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:29:15.029360 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: BEGIN
[0m12:29:15.029995 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m12:29:15.031776 [debug] [Thread-3  ]: SQL status: BEGIN in 0.0 seconds
[0m12:29:15.032178 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:29:15.032557 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_daily_sales"} */

  
    

  create  table "airflow"."public"."fct_daily_sales__dbt_tmp"
  
  
    as
  
  (
    

WITH daily_sales AS (
    SELECT
        DATE_TRUNC('day', order_date) as date,
        COUNT(DISTINCT order_id) as total_orders,
        COUNT(DISTINCT customer_id) as unique_customers,
        SUM(amount) as total_amount
    FROM "airflow"."public"."stg_orders"
    WHERE status = 'completed'
    GROUP BY 1
)

SELECT
    date,
    total_orders,
    unique_customers,
    total_amount,
    total_amount / NULLIF(total_orders, 0) as avg_order_value,
    total_amount / NULLIF(unique_customers, 0) as avg_customer_spend
FROM daily_sales
  );
  
[0m12:29:15.033029 [debug] [Thread-4  ]: SQL status: BEGIN in 0.0 seconds
[0m12:29:15.033353 [debug] [Thread-4  ]: Using postgres connection "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:29:15.033731 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_customer_purchase_patterns"} */

  
    

  create  table "airflow"."public"."fct_customer_purchase_patterns__dbt_tmp"
  
  
    as
  
  (
    

WITH customer_orders AS (
    SELECT
        customer_id,
        order_date,
        amount,
        LAG(order_date) OVER (
            PARTITION BY customer_id 
            ORDER BY order_date
        ) as previous_order_date
    FROM "airflow"."public"."stg_orders"
),

customer_metrics AS (
    SELECT
        customer_id,
        COUNT(*) as total_orders,
        SUM(amount) as total_amount,
        MIN(order_date) as first_order_date,
        MAX(order_date) as last_order_date,
        AVG(amount) as avg_order_amount,
        -- Use PostgreSQL's date subtraction
        AVG(
            CASE 
                WHEN previous_order_date IS NOT NULL 
                THEN DATE_PART('day', order_date::timestamp - previous_order_date::timestamp)
            END
        ) as avg_days_between_orders
    FROM customer_orders
    GROUP BY customer_id
)

SELECT
    customer_id,
    total_orders,
    total_amount,
    first_order_date,
    last_order_date,
    avg_order_amount,
    avg_days_between_orders,
    CASE
        WHEN total_orders >= 10 THEN 'High'
        WHEN total_orders >= 5 THEN 'Medium'
        ELSE 'Low'
    END as frequency_segment,
    CASE
        WHEN avg_order_amount >= 200 THEN 'Premium'
        WHEN avg_order_amount >= 100 THEN 'Standard'
        ELSE 'Basic'
    END as value_segment
FROM customer_metrics
  );
  
[0m12:29:15.037046 [debug] [Thread-3  ]: SQL status: SELECT 2 in 0.0 seconds
[0m12:29:15.037532 [debug] [Thread-4  ]: SQL status: SELECT 3 in 0.0 seconds
[0m12:29:15.040721 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:29:15.043549 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_daily_sales"} */
alter table "airflow"."public"."fct_daily_sales" rename to "fct_daily_sales__dbt_backup"
[0m12:29:15.043182 [debug] [Thread-4  ]: Using postgres connection "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:29:15.043952 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_customer_purchase_patterns"} */
alter table "airflow"."public"."fct_customer_purchase_patterns" rename to "fct_customer_purchase_patterns__dbt_backup"
[0m12:29:15.044224 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:29:15.046549 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:29:15.047087 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_daily_sales"} */
alter table "airflow"."public"."fct_daily_sales__dbt_tmp" rename to "fct_daily_sales"
[0m12:29:15.046860 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:29:15.049652 [debug] [Thread-4  ]: Using postgres connection "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:29:15.050151 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_customer_purchase_patterns"} */
alter table "airflow"."public"."fct_customer_purchase_patterns__dbt_tmp" rename to "fct_customer_purchase_patterns"
[0m12:29:15.049927 [debug] [Thread-3  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:29:15.053252 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: COMMIT
[0m12:29:15.053771 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:29:15.054031 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: COMMIT
[0m12:29:15.053547 [debug] [Thread-4  ]: SQL status: ALTER TABLE in 0.0 seconds
[0m12:29:15.055251 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: COMMIT
[0m12:29:15.055837 [debug] [Thread-4  ]: Using postgres connection "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:29:15.056123 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: COMMIT
[0m12:29:15.055578 [debug] [Thread-3  ]: SQL status: COMMIT in 0.0 seconds
[0m12:29:15.058036 [debug] [Thread-3  ]: Applying DROP to: "airflow"."public"."fct_daily_sales__dbt_backup"
[0m12:29:15.059891 [debug] [Thread-3  ]: Using postgres connection "model.simple_dbt_project.fct_daily_sales"
[0m12:29:15.060205 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_daily_sales"} */
drop table if exists "airflow"."public"."fct_daily_sales__dbt_backup" cascade
[0m12:29:15.058305 [debug] [Thread-4  ]: SQL status: COMMIT in 0.0 seconds
[0m12:29:15.062181 [debug] [Thread-4  ]: Applying DROP to: "airflow"."public"."fct_customer_purchase_patterns__dbt_backup"
[0m12:29:15.062808 [debug] [Thread-4  ]: Using postgres connection "model.simple_dbt_project.fct_customer_purchase_patterns"
[0m12:29:15.063363 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: /* {"app": "dbt", "dbt_version": "1.7.3", "profile_name": "default", "target_name": "dev", "node_id": "model.simple_dbt_project.fct_customer_purchase_patterns"} */
drop table if exists "airflow"."public"."fct_customer_purchase_patterns__dbt_backup" cascade
[0m12:29:15.063103 [debug] [Thread-3  ]: SQL status: DROP TABLE in 0.0 seconds
[0m12:29:15.064615 [debug] [Thread-3  ]: Timing info for model.simple_dbt_project.fct_daily_sales (execute): 12:29:15.007702 => 12:29:15.064466
[0m12:29:15.065284 [debug] [Thread-3  ]: On model.simple_dbt_project.fct_daily_sales: Close
[0m12:29:15.065989 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7c1740e4-70c4-4aab-8c9b-5b32c77e8a3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff817823d0>]}
[0m12:29:15.066540 [info ] [Thread-3  ]: 4 of 4 OK created sql table model public.fct_daily_sales ....................... [[32mSELECT 2[0m in 0.07s]
[0m12:29:15.067056 [debug] [Thread-3  ]: Finished running node model.simple_dbt_project.fct_daily_sales
[0m12:29:15.064914 [debug] [Thread-4  ]: SQL status: DROP TABLE in 0.0 seconds
[0m12:29:15.068291 [debug] [Thread-4  ]: Timing info for model.simple_dbt_project.fct_customer_purchase_patterns (execute): 12:29:15.023914 => 12:29:15.068152
[0m12:29:15.068607 [debug] [Thread-4  ]: On model.simple_dbt_project.fct_customer_purchase_patterns: Close
[0m12:29:15.069158 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7c1740e4-70c4-4aab-8c9b-5b32c77e8a3e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8178bca0>]}
[0m12:29:15.069614 [info ] [Thread-4  ]: 3 of 4 OK created sql table model public.fct_customer_purchase_patterns ........ [[32mSELECT 3[0m in 0.07s]
[0m12:29:15.070073 [debug] [Thread-4  ]: Finished running node model.simple_dbt_project.fct_customer_purchase_patterns
[0m12:29:15.071248 [debug] [MainThread]: Using postgres connection "master"
[0m12:29:15.071531 [debug] [MainThread]: On master: BEGIN
[0m12:29:15.071766 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:29:15.074186 [debug] [MainThread]: SQL status: BEGIN in 0.0 seconds
[0m12:29:15.074512 [debug] [MainThread]: On master: COMMIT
[0m12:29:15.074763 [debug] [MainThread]: Using postgres connection "master"
[0m12:29:15.074991 [debug] [MainThread]: On master: COMMIT
[0m12:29:15.075301 [debug] [MainThread]: SQL status: COMMIT in 0.0 seconds
[0m12:29:15.075576 [debug] [MainThread]: On master: Close
[0m12:29:15.076078 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:29:15.076410 [debug] [MainThread]: Connection 'model.simple_dbt_project.my_first_model' was properly closed.
[0m12:29:15.076693 [debug] [MainThread]: Connection 'model.simple_dbt_project.stg_orders' was properly closed.
[0m12:29:15.076930 [debug] [MainThread]: Connection 'model.simple_dbt_project.fct_customer_purchase_patterns' was properly closed.
[0m12:29:15.077175 [debug] [MainThread]: Connection 'model.simple_dbt_project.fct_daily_sales' was properly closed.
[0m12:29:15.077468 [info ] [MainThread]: 
[0m12:29:15.077759 [info ] [MainThread]: Finished running 2 view models, 2 table models in 0 hours 0 minutes and 0.23 seconds (0.23s).
[0m12:29:15.078582 [debug] [MainThread]: Command end result
[0m12:29:15.086174 [info ] [MainThread]: 
[0m12:29:15.086624 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:29:15.087036 [info ] [MainThread]: 
[0m12:29:15.087464 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m12:29:15.088266 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.5275807, "process_user_time": 1.932368, "process_kernel_time": 0.152581, "process_mem_max_rss": "182184", "process_out_blocks": "1662", "process_in_blocks": "0"}
[0m12:29:15.088729 [debug] [MainThread]: Command `dbt run` succeeded at 12:29:15.088628 after 0.53 seconds
[0m12:29:15.089036 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85a8ebb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff820ceb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8245a9d0>]}
[0m12:29:15.089362 [debug] [MainThread]: Flushing usage events
